function cms_edit_content(a){$("#content_block_"+a).hide(),$("#edit_content_block_"+a).show()}function cms_save_content(a){$.ajax({url:"/cms.php",data:{action:"update_content",container:a,content:CKEDITOR.instances["cke_"+a].getData()},type:"POST",dataType:"html",success:function(){$("#content_body_"+a).html(CKEDITOR.instances["cke_"+a].getData()),$("#content_block_"+a).show(),$("#edit_content_block_"+a).hide()}})}function submit_comment(a){var b=$("#blog_comment_email").val(),c=$("#blog_comment_name").val(),d=$("#blog_comment_web").val(),e=$("#blog_new_comment").val();$.ajax({url:"/blog.php",data:{action:"post_comment_check",name:c,email:b,web:d,comment:e,blog_id:a},type:"POST",dataType:"html",success:function(f){$.ajax({url:"blog.php",data:{action:"post_comment",name:c,email:b,comment:e,web:d,blog_id:a,check_val:f},type:"POST",dataType:"html",success:function(){var a=$("#blog_comment_blank").clone().attr("id","").hide();a.find(".blog_comment_body").html(e),a.find(".blog_comment_name").html("By "+c),date=new Date,a.find(".blog_comment_date").html("just posted"),$("#blog_comment_container").prepend(a),$("#new_comment_box").fadeOut(function(){$("#blog_comment_container .blog_comment").fadeIn("slow")})}})}})}function edit_blog(){$("#blog_edit").show(),$("#blog_body").hide()}function delete_blog_comment(a){$.ajax({url:"/blog.php",data:{action:"remove_blog_comment",blog_comment_id:a},type:"POST",dataType:"html",success:function(b){"ok"==b&&$("#blog_comment_"+a).fadeOut()}})}function approve_blog_comment(a){$.ajax({url:"blog.php",data:{action:"approve_blog_comment",blog_comment_id:a},type:"POST",dataType:"html",success:function(b){"ok"==b&&$("#blog_comment_"+a+" .approve_comment").fadeOut()}})}function json_to_ul(a,b){if("undefined"==typeof a||"undefined"==typeof b)return!1;var c=[];$.each(a,function(a,b){c.push('<li class="blogpost"><a href="'+b.url+'">'+b.title+"</a></li>")}),$("<ul/>",{"class":"blogpostlist",html:c.join("")}).appendTo(b)}function json_on_id(a,b){$.ajax({type:"GET",url:a,data:"json=1",dataType:"jsonp",jsonpCallback:b,cache:!0,success:function(a){json_to_ul(a,"#"+b)}})}function reset_field_value(a){"undefined"!=typeof CKEDITOR.instances[a]?CKEDITOR.instances[a].setData(table_data.defaults[a]):"undefined"!=typeof("#"+a).val?$("#"+a).val(table_data.defaults[a]):$("#"+a).html(table_data.defaults[a])}function tree_clear(a){var b=!1;$(".tree_column").each(function(){b&&$(this).remove(),$(this).attr("id").replace("tree_column_","")==a&&(b=!0)})}function tree_sub_click(){var a=$(this).closest(".tree_column").attr("id").replace("tree_column_","");if(tree_clear(a),$("#tree_column_"+a+" .selected").removeClass("selected"),$(this).addClass("selected"),$(this).hasClass("tree_column_directory")){var b=$(this).attr("id").replace("tree_node_","");$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"load_node",node_id:b},success:function(a){if("error"==a.status)alert(a.error);else{$("#tree_"+tree_data.tree_name).append("<div class='tree_column' id='tree_column_"+a.node_id+"'></div>"),$("#tree_column_"+a.node_id).append(tree_node_header(a));for(i in a.nodes)$("#tree_column_"+a.node_id).append(tree_node_string(a.nodes[i].node_name,a.nodes[i].node_id));for(i in a.items)$("#tree_column_"+a.node_id).append("<div class='tree_column_row tree_column_item' id='tree_obj_"+a.items[i].item_id+"'>"+a.items[i].item_title+"</div>");$("#tree_column_"+a.node_id+" .tree_column_row").click(tree_sub_click);var b=$("#tree_"+tree_data.tree_name).find(".tree_column").length*($("#tree_"+tree_data.tree_name).find(".tree_column").first().width()+1);$("#tree_"+tree_data.tree_name).css("width",b),$("#tree_"+tree_data.tree_name).parent().scrollLeft($("#tree_"+tree_data.tree_name).width()-$("#tree_"+tree_data.tree_name).parent().width())}}})}else{var b=$(this).attr("id").replace("tree_obj_","");$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"obj_detail",id:b},success:function(a){$("#tree_"+tree_data.tree_name).append("<div class='tree_column tree_column_obj' id='tree_column_obj_"+a.id+"'>"+a.html+"</div>");var b=$("#tree_"+tree_data.tree_name).find(".tree_column").length*($("#tree_"+tree_data.tree_name).find(".tree_column").first().width()+1);$("#tree_"+tree_data.tree_name).css("width",b),$("#tree_"+tree_data.tree_name).parent().scrollLeft($("#tree_"+tree_data.tree_name).width()-$("#tree_"+tree_data.tree_name).parent().width())}})}}function tree_add(a){var b=prompt("Enter a name for the new directory:"),c=$(a).closest(".tree_column");null!=b&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"add_node",node_id:c.attr("id").replace("tree_column_",""),name:b},success:function(b){if("ok"==b.status){var d=!1;c.find(".tree_column_row").each(function(){return $(this).html().replace(/\<span\>.*\<\/span\>/,"").toLowerCase()>b.name.toLowerCase()?($(this).before(tree_node_string(b.name,b.node_id)),$("#tree_node_"+b.node_id).click(tree_sub_click),d=!0,!1):void 0}),d||($(a).closest(".tree_column").append(tree_node_string(b.name,b.node_id)),$("#tree_node_"+b.node_id).click(tree_sub_click))}}})}function tree_delete(a){var b=$(a).closest(".tree_column").attr("id").replace("tree_column_",""),c=$("#tree_node_"+b).html().replace(/\<span\>.*\<\/span\>/,""),d=confirm("Are you sure you want to delete the node '"+c+"' ?");1==d&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"remove_node",node_id:b},success:function(a){"ok"==a.status?(parent_node=$("#tree_node_"+b).closest(".tree_column").attr("id").replace("tree_column_",""),$("#tree_node_"+b).remove(),tree_clear(parent_node)):alert("Error!")}})}function tree_rename(a){var b=$(a).closest(".tree_column").attr("id").replace("tree_column_",""),c=$("#tree_node_"+b).html().replace(/\<span\>.*\<\/span\>/,""),d=prompt("Enter a name for the new directory:",c);null!=d&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"rename_node",node_id:b,name:d},success:function(a){"ok"==a.status?$("#tree_node_"+b).html($("#tree_node_"+b).html().replace(c,d)):alert("Error!")}})}function tree_upload(a){var b=$(a).closest(".tree_column").attr("id").replace("tree_column_","");document.location=tree_data.action_file+"?node_id="+b+"&action=new"}function tree_node_string(a,b){return"<div class='tree_column_row tree_column_directory' id='tree_node_"+b+"'>"+a+"<span>&gt</span></div>"}function tree_node_header(a){return buttons="",buttons+=a.actions_before,1==a.upload&&(buttons+="<img src='/images/app/send_doc.png' title='Upload' onclick='tree_upload(this);' /> "),1==a.add&&(buttons+="<img src='/images/app/new2.png' title='New Folder' onclick='tree_add(this);' /> "),1==a.edit&&(buttons+="<img src='/images/app/pencil.png' title='Rename' onclick='tree_rename(this);' /> <img src='/images/app/remove2.png' title='Remove' onclick='tree_delete(this);' />"),"<div class='tree_column_header'><span>"+a.node_name+"</span>"+buttons+"</div>"}lightning||(lightning={}),lightning.admin={},lightning.admin.messageEditor={checkVars:function(){var a=$("#message_criteria_input_array").val();$.ajax({url:"/admin/mailing/messages",data:{action:"fields",criteria_list:a,message_id:$("#id").val()},dataType:"JSON",type:"GET",success:function(b){a=a.split(",");for(var c=0;c<a.length;c++)if(""!=a[c])for(var d in b.criteria){var e=b.criteria[d].criteria_id;if(b.criteria[d].criteria_id==a[c])for(var f in b.criteria[d].variables){var g=b.criteria[d].variables[f];if(0==$("#var_"+e+"_"+g).length){var h=b.criteria[d].values&&b.criteria[d].values[g]?b.criteria[d].values[g]:"";$("#message_criteria_box_"+a[c]).append('<div id="var_'+e+"_"+g+'" >'+g+': <input type="text" name="var_'+e+"_"+g+'" value="'+h+'"></div>')}}}},error:function(){alert("error")}})}},lightning.admin.messages={send:function(a){$("#message_status").html("Starting ...\n"),$(".mail_buttons").fadeOut();var b=0,c=this;$.ajax({url:"/admin/mailing/send?action=send-"+a+"&id="+lightning.vars.message_id,dataType:"text",data:{token:lightning.vars.token},type:"POST",stream:!0,xhrFields:{onprogress:function(a){var d=a.currentTarget.response;c.addContent("#message_status",d.substring(b)),b=d.length}},complete:function(){$(".mail_buttons").fadeIn()},error:function(){$(".mail_buttons").fadeIn()}})},addContent:function(a,b){var c=$(a);c.html(c.html()+b),c.animate({scrollTop:c.attr("scrollHeight")},500)}},lightning.ajax={jqueryAjax:function(){},init:function(){this.jqueryAjax=jQuery.ajax,jQuery.ajax=this.call},success:function(a,b){if("HTML"==a.dataType&&(a.user_success?a.user_success(b):lightning.dialog.setContent(b)),b.messages)for(var c in b.messages)lightning.dialog.add(b.messages[c],"message");b.errors&&b.errors.length&&lightning.ajax.error(a,b),"success"==b.status?a.user_success?a.user_success(b):lightning.dialog.hide():"redirect"==b.status&&(document.location=b.location)},error:function(a,b){lightning.dialog.showPrepared(function(){if(void 0==b)lightning.dialog.add("Communication Error","error");else if("string"==typeof b)lightning.dialog.add(b,"error");else if(b.errors)for(var c in b.errors)lightning.dialog.add(b.errors[c],"error");else lightning.dialog.add('There was an error loading the page. Please reload the page. If the problem persists, please <a href="/contact">contact support</a>.',"error"),b.hasOwnProperty("status")&&lightning.dialog.add("HTTP: "+b.status,"error"),b.hasOwnProperty("responseText")&&!b.responseText.match(/<html/i)&&lightning.dialog.add(b.responseText,"error");a.user_error&&a.user_error(b)})},call:function(a){a.user_error=a.error,a.user_success=a.success,a.success=function(b){lightning.ajax.success(a,b)},a.error=function(b){lightning.ajax.error(a,b)},lightning.ajax.jqueryAjax(a)}},lightning.cms={edit:function(a){$("#"+a).attr("contentEditable","true"),lightning.ckeditors[a]=CKEDITOR.inline(a,{toolbar:CKEDITOR.config.toolbar_Full,allowedContent:!0}),CKFinder.setupCKEditor(lightning.ckeditors[a],"/js/ckfinder/"),$("#"+a.replace(/^cms_/,"cms_edit_")).hide(),$("#"+a.replace(/^cms_/,"cms_save_")).removeClass("hide").show()},save:function(a){lightning.ckeditors[a].destroy();var b=this;$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:a.replace(/^cms_/,""),token:lightning.vars.token,action:"save",content:$("#"+a).html()},success:function(c){if("success"==c.status)$("#"+a.replace(/^cms_/,"cms_edit_")).show(),$("#"+a.replace(/^cms_/,"cms_save_")).hide();else{var d="";for(var e in c.errors)d+=c.error[e]+" ";""==d&&(d="Could not save: Unknown error."),alert(d),b.edit()}},error:function(){alert("The page could not be saved, please try again later."),b.edit()}})},initImage:function(){$(".imagesCSS").keyup(function(){var a=$(this),b=a.attr("id").replace("_class",""),c=a.attr("name")+" "+a.val();$("#"+b).removeClass().addClass(c)})},editImage:function(a){var b=this;CKFinder.popup({basePath:lightning.cms.basepath,selectActionFunction:function(c){b.updateImage(a,c)}})},updateImage:function(a,b){$("#cms_"+a).attr("src",b)},saveImage:function(a){$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:a,"class":$("#cms_"+a+"_class").val(),token:lightning.vars.token,action:"save-image",content:$("#cms_"+a).attr("src")},success:function(a){if("success"!=a.status){var b="";for(var c in a.errors)b+=a.error[c]+" ";""==b&&(b="Could not save: Unknown error.")}},error:function(){alert("The image could not be saved, please try again later.")}})},initPlain:function(){var a=this;$(".cms_edit_plain").click(function(b){var c=$(b.target).attr("id").replace(/^cms_edit_/,"");a.editPlain(c)}),$(".cms_save_plain").click(function(b){var c=$(b.target).attr("id").replace(/^cms_save_/,"");a.savePlain(c)})},editPlain:function(a){$("#cms_edit_"+a).hide(),$("#cms_save_"+a).show(),$("#cms_display_"+a).hide(),$("#cms_"+a).show()},savePlain:function(a){$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:a,token:lightning.vars.token,action:"save",content:$("#cms_"+a).val()},success:function(b){if("success"!=b.status){var c="";for(var d in b.errors)c+=b.error[d]+" ";""==c&&(c="Could not save: Unknown error.")}else $("#cms_edit_"+a).show(),$("#cms_save_"+a).hide(),$("#cms_"+a).hide(),$("#cms_display_"+a).html($("#cms_"+a).val()).show()},error:function(){alert("The image could not be saved, please try again later.")}})},initDate:function(){var a=this;$(".cms_edit_date").click(function(b){var c=$(b.target).attr("id").replace(/^cms_edit_/,"");a.editDate(c)}),$(".cms_save_date").click(function(b){var c=$(b.target).attr("id").replace(/^cms_save_/,"");a.saveDate(c)})},editDate:function(a){$("#cms_edit_"+a).hide(),$("#cms_save_"+a).show(),$("#cms_"+a).show()},saveDate:function(a){$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{id:a,key:$("#cms_key_"+a).val(),column:$("#cms_column_"+a).val(),table:$("#cms_table_"+a).val(),token:lightning.vars.token,action:"update-date",date_m:$("#cms_"+a+"_m").val(),date_d:$("#cms_"+a+"_d").val(),date_y:$("#cms_"+a+"_y").val()},success:function(b){if("success"!=b.status){var c="";for(var d in b.errors)c+=b.error[d]+" ";""==c&&(c="Could not save: Unknown error.")}else{$("#cms_edit_"+a).show(),$("#cms_save_"+a).hide(),$("#cms_"+a).hide();var e=$("#cms_"+a+"_m").val()+"/"+$("#cms_"+a+"_d").val()+"/"+$("#cms_"+a+"_y").val();$("#date_"+a).text(e)}},error:function(){alert("The image could not be saved, please try again later.")}})}},lightning.dialog={originalScroll:0,newPosition:0,dialogBox:!1,dialogBoxLoader:void 0,dialogBoxInner:void 0,init:function(){this.dialogBox||($('<div id="veil"></div><div id="dialog_box"><div class="table_data clear border_top"><div class="inner" id="dialog_box_inner"><div class="messenger error"><ul></ul></div><div class="messenger message"><ul></ul></div><div class="content"><ul></ul></div></div><div class="inner" id="dialog_box_loader"><p align="center"><img src="/images/coganim2.gif" class="loader_image"></p></div></div></div>').prependTo("body"),$("#veil").click(lightning.dialog.hide),$(window).scroll(lightning.dialog.reposition).resize(lightning.dialog.reposition),this.dialogBox=$("#dialog_box"),this.dialogBoxLoader=$("#dialog_box_loader"),this.dialogBoxInner=$("#dialog_box_inner"))},reposition:function(){if(lightning.dialog.dialogBox.is(":visible"))if($(window).height()>lightning.dialog.dialogBox.height())lightning.dialog.newPosition=($(window).height()-lightning.dialog.dialogBox.height())/2+$(window).scrollTop(),lightning.dialog.dialogBox.css("top",lightning.dialog.newPosition+"px");else{lightning.dialog.newPosition=lightning.dialog.originalScroll-$(window).scrollTop()+lightning.dialog.dialogBox.position().top;var a=Math.max(0,$(window).height()+$(window).scrollTop()-lightning.dialog.dialogBox.height()-20),b=$(window).scrollTop()+10;lightning.dialog.newPosition=Math.min(lightning.dialog.newPosition,b),lightning.dialog.newPosition=Math.max(lightning.dialog.newPosition,a),lightning.dialog.originalScroll=$(window).scrollTop(),lightning.dialog.dialogBox.css("top",lightning.dialog.newPosition+"px")}},showPosition:function(){this.originalScroll=$(window).scrollTop(),this.reposition()},showURL:function(a){this.show(),$.ajax({dataType:"HTML",url:a,success:function(a){this.setContent(a)}})},show:function(a){if(this.dialogBoxLoader.stop(!0),this.dialogBoxInner.stop(!0),"undefined"==a&&(a=!0),this.dialogBox.is(":visible")){var b=this;this.dialogBoxInner.fadeOut("fast",function(){b.showContainer(a)})}else this.showPosition(),this.showContainer(a)},showContainer:function(a){this.clear(),$("#veil").fadeIn("fast"),this.dialogBoxInner.hide(),a?this.dialogBoxLoader.show():this.dialogBoxLoader.hide(),this.dialogBox.fadeIn("fast",lightning.dialog.reposition)},showPrepared:function(a){this.dialogBoxLoader.stop(!0),this.dialogBoxInner.stop(!0),$("#veil").fadeIn("fast");var b=this;this.dialogBox.fadeOut("fast",function(){b.clear(),void 0!=a&&a(),b.dialogBox.fadeIn("fast",lightning.dialog.reposition)})},hide:function(){lightning.dialog.dialogBox.fadeOut("fast",function(){$("#veil").fadeOut("fast")})},clear:function(){this.dialogBoxInner.find(".content").empty().hide(),this.dialogBoxInner.find(".error ul").empty(),this.dialogBoxInner.find(".error").hide(),this.dialogBoxInner.find(".message ul").empty(),this.dialogBoxInner.find(".message").hide(),this.dialogBoxLoader.hide()},addContent:function(a){a=$(a).hide(),this.dialogBoxInner.find(".content").append(a),a.fadeIn("fast"),this.dialogBoxInner.fadeIn("fast"),this.dialogBoxInner.find(".content").fadeIn("fast"),this.reposition()},setContent:function(a,b){var c=this;this.dialogBoxLoader.fadeOut("fast",function(){this.dialogBoxInner.fadeOut("fast",function(){c.showPrepared(function(){this.dialogBoxInner.find(".content").html(a).show(),this.dialogBoxInner.fadeIn("fast")}),b&&b()})}),this.reposition()},add:function(a,b){a=$("<li>"+a+"</li>");var c="message"==b?".message":".error",d=this;this.dialogBoxLoader.fadeOut("fast",function(){d.dialogBoxInner.find(c).is(":visible")?(a.hide(),d.dialogBoxInner.find(c+" ul").append(a),a.fadeIn("fast")):(d.dialogBoxInner.find(c+" ul").append(a),d.dialogBoxInner.is(":visible")?d.dialogBoxInner.find(c).fadeIn("fast"):d.dialogBoxInner.find(c).show()),d.dialogBoxInner.find(c).fadeIn("fast")}),this.reposition()},setContent:function(a,b){this.dialogBoxInner.fadeOut("fast",function(){$(this).html(a).fadeIn("fast",b)})}},lightning.getMethodReference=function(a){var b=a.split("."),c=window;for(var d in b)c=c[b[d]];return c},lightning.startup={init:function(){this.initForms(),this.initNav(),lightning.ajax.init(),lightning.dialog.init()},initNav:function(){lightning.vars.active_nav&&lightning.vars.active_nav.length>0&&$("nav ."+lightning.vars.active_nav).addClass("active")},initForms:function(){var a=$("form.validate");0!=a.length&&($.validator.addMethod("passwordLength",$.validator.methods.minlength,"Your password must be at least {0} characters long."),$.validator.addMethod("passwordVerify",function(a,b,c){var d=$(b),e=d.closest("form").find(c);return this.settings.onfocusout&&e.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){d.valid()}),a===e.val()},"Please enter the same password twice."),$.validator.addClassRules("password",{required:!0,passwordLength:6}),$.validator.addClassRules("password2",{required:!0,passwordLength:6,passwordVerify:".password"}),a.each(function(){var a=$(this).attr("id");lightning.formValidation&&lightning.formValidation[a]?$(this).validate(lightning.formValidation[a]):$(this).validate()}))}},lightning.multiplier={init:function(){var a=this;$(".multiplier").each(function(){$(this).on("click",".multiplier_add",null,function(b){a.addOption(b.target)}),$(this).on("click",".multiplier_remove",null,function(b){a.removeOption(b.target)}),$(this).append('<input class="multiplier_count" value="0" type="hidden" />'),$(this).find(".template").hide(),a.addOption(this)})},addOption:function(a){var b=$(a).closest(".multiplier"),c=b.find(".template").html(),d=b.find(".multiplier_count").val(),e=$('<div class="item"></div>').append(c.replace(/%/g,d+1));b.find(".multiplier_count").val(d+1),b.append(e),this.adjustControls(b)},removeOption:function(a){$(a).closest(".item").remove(),this.adjustControls($(a).closest(".multiplier"))},adjustControls:function(a){a.find(".multiplier_add").hide(),a.find(".multiplier_add").last().show(),a.find(".multiplier_remove").show()}},lightning.page={edit:function(){$(".page_edit").fadeIn(),$(".page_edit_links").fadeOut(),$("#page_display").attr("contentEditable","true"),lightning.ckeditors.page_editor=CKEDITOR.inline("page_display",{toolbar:CKEDITOR.config.toolbar_Full}),CKFinder.setupCKEditor(lightning.ckeditors.page_editor,"/js/ckfinder/")},save:function(){$("#save_button").fadeOut(),lightning.ckeditors.page_editor.destroy(),delete lightning.ckeditors.page_editor;var a={page_id:$("#page_id").val(),token:$("#token").val(),action:"save",title:$("#page_title").val(),url:$("#page_url").val(),description:$("#page_description").val(),keywords:$("#page_keywords").val(),sitemap:$("#page_sitemap").is(":checked")?1:0,layout:$("#page_layout").val(),page_body:$("#page_display").html()},b=this;$.ajax({url:"/page",type:"POST",dataType:"json",data:a,success:function(a){"OK"==a.status?($(".page_edit").fadeOut(),$(".page_edit_links").fadeIn(),$("#page_display").attr("contentEditable","false"),$("#page_id").val(a.page_id),$("#page_url").val(a.url),document.title=a.title,$("#page_title").val(a.title)):(alert(a.error),b.edit())},error:function(){alert("The page could not be saved, please try again later."),b.edit()}})}},lightning.stats={charts:{},loadData:function(){var a={sets:[]};$("#stats_controls select").not("#tracker_\\%").each(function(){var b=$(this).attr("id").replace("tracker_","");a.sets.push({tracker:$("#tracker_"+b).val(),sub_id:$("#sub_id_"+b).val()})}),this.getTrackerStats(a,this.updateStats)},drawData:function(a,b){var c=document.getElementById(a).getContext("2d"),d=lightning.vars.chart[a].renderer;lightning.stats.charts[a]&&lightning.stats.charts[a].destroy(),lightning.stats.charts[a]=new Chart(c)[d](b,{responsive:!0,datasetFill:!1})},updateTotals:function(a,b){var c=$("#chart_totals_"+a);if(1==c.length)if(c.empty(),b.datasets)for(var d in b.datasets){var e=0;for(var f in b.datasets[d].data)e+=parseInt(b.datasets[d].data[f]);var g="";if(lightning.vars.chart[a].params.diff){difference=e-b.datasets[d].previous;var h=difference<0?"red":"green",i=difference<0?"":"+",j=0!=b.datasets[d].previous?(100*difference/b.datasets[d].previous).toFixed(1):0;g='<span class="strong '+h+'">'+i+difference+" ("+j+"%)</span>"}lightning.vars.chart[a].params.number_format&&"money"==lightning.vars.chart[a].params.number_format&&(e="$"+e.toFixed(2)),c.append($("<li>"+(b.datasets[d].label?b.datasets[d].label:d)+": "+e+" "+g+"</li>"))}else{var k=0;for(var d in b)k+=b[d].value;c.append($("<li>Total: "+k+"</li>"))}},getTrackerStats:function(a,b,c){b.action="trackerStats",$.ajax({type:"GET",url:"/admin/tracker",dataType:"JSON",data:b,success:c})},getParameters:function(a){if(lightning.vars.chart[a].params){var b={};for(var c in lightning.vars.chart[a].params){var d=lightning.vars.chart[a].params[c];d.source?b[c]=$("#chart_controls_"+a+" #"+d.source).val():d.value&&(b[c]=d.value)}return b}return{}},updateStats:function(a){var b=this,c=this.getParameters(a);c.action="get-data",c.id=a,$.ajax({type:"GET",url:lightning.vars.chart[a].url,dataType:"JSON",data:c,success:function(c){b.drawData(a,c.data),b.updateTotals(a,c.data)}})},init:function(){var a=this;$(".chart_controls input, .chart_controls select").change(function(b){var c=$(b.target).closest(".chart_controls").attr("id").replace("chart_controls_","");a.updateStats(c)});for(var b in lightning.vars.chart)lightning.vars.chart[b].data?(a.drawData(b,lightning.vars.chart[b].data),a.updateTotals(b,lightning.vars.chart[b].data)):lightning.vars.chart[b].ajax&&a.updateStats(b)}},lightning.table={init:function(){$(".add_image").click(lightning.table.clickAddImage),$(".linked_images").on("click",".remove",lightning.table.removeLinkedImage)},click:function(a){var b=a.currentTarget.id;if("INPUT"!=a.target.tagName&&void 0!=table_data.rowClick)switch(table_data.rowClick.type){case"url":document.location=table_data.rowClick.url+b;break;case"action":document.location=lightning.table.createUrl(table_data.rowClick.action,b)}},createUrl:function(a,b){var c=[];if(c.push("action="+encodeURIComponent(a)),c.push("id="+encodeURIComponent(b)),table_data.table&&c.push("table="+encodeURIComponent(table_data.table)),table_data.parent_link&&c.push(table_data.parent_link+"="+encodeURIComponent(table_data.parent_id)),table_data.vars)for(var d in table_data.vars)null!=table_data.vars[d]&&c.push(d+"="+encodeURIComponent(table_data.vars[d]));return url="?"+c.join("&")},selectAll:function(a){$(".taf_"+a).prop("checked",$("#taf_all_"+a).is(":checked"))},searchTimeout:null,searchIndex:0,searchIndexDisplayed:0,search:function(a){var b=$(a).val();this.searchIndex++,clearTimeout(this.searchTimeout);var c=this;this.searchTimeout=setTimeout(function(){table_data.vars.ste=b,$.ajax({url:table_data.action_file,type:"GET",dataType:"json",data:{ste:b,i:c.searchIndex,action:"search"},success:function(a){a.d>c.searchIndexDisplayed&&(c.searchIndexDisplayed=a.d,$(".table_list").html(a.html))}})},500)},addLink:function(a){var b=$("#"+a+"_list"),c=b.val(),d=$("#"+a+"_list option:selected").text();this.removeLink(a,c);var e=$("#"+a+"_input_array");e.val(e.val()+c+","),$("#"+a+"_list_container").append($('<div class="'+a+'_box table_link_box_selected" id="'+a+"_box_"+c+'">'+d+' <a href="#" onclick="javascript:lightning.table.removeLink(\''+a+"', "+c+');return false;">X</a></div>'))},removeLink:function(a,b){$("#"+a+"_box_"+b).remove();var c=$("#"+a+"_input_array"),d=c.val(),e=new RegExp("[\\^,]"+b+",","i");d=d.replace(e,","),e=new RegExp("^"+b+",","i"),d=d.replace(e,""),c.val(d)},clickAddImage:function(a){var b=a.target.id.replace("add_image_","");CKFinder.popup({basePath:lightning.vars.table.links[b].web_location,selectActionFunction:function(a){lightning.table.addImageCallback(b,a)}})},addImageCallback:function(a,b){$("#linked_images_"+a).append('<span class="selected_image_container"><input type="hidden" name="linked_images_'+a+'[]" value="'+b+'"><span class="remove">X</span><img src="'+b+'" /></span>')},removeLinkedImage:function(a){$(a.target).closest(".selected_image_container").remove()},autocomplete:function(){var a=$(this).attr("id");table_data.fields||(table_data.fields={},table_data.fields[a]={});var b=$(this).val();b.length>=2&&(!table_data.fields[a].last_fetch||table_data.fields[a].last_fetch!=b)&&(table_data.fields[a].last_fetch=b,$.ajax({url:table_data.action_file,type:"get",dataType:"json",data:{action:"autocomplete",field:a,st:table_data.fields[a].last_fetch},success:function(c){b==table_data.fields[a].last_fetch&&lightning.table.autocompleteDropdown(a,c.results)},error:function(){alert("error")}}))},autocompleteDropdown:function(a,b){$(".table_container").each(function(){$(this).attr("id")!="table_container_"+a?$(this).remove():$("#list_"+a).empty()}),0==$(".table_container").length&&$("#"+a).after("<div id='table_container_"+a+"' class='table_container'><div id='list_"+a+"'></div></div>");var c=0;for(var d in b)$("#list_"+a).append('<span id="'+a+"_"+d+'" >'+b[d]+"</span>"),c++;$("#list_"+a+" span").click(lightning.table.setAutocompleteSelection)},setAutocompleteSelection:function(){var a=$(this).attr("id").split("_"),b=a.pop(),c=a.join("_");$("#table_container_"+c).remove(),$("#"+c).val(b)},deleteSubtable:function(a){var b=$(a).closest("div").attr("id").replace("subtable_",""),c=b.split("_");c=c[c.length-1],entry_id_table=b.replace("_"+c,""),parseInt(c)>0?$("#delete_subtable_"+entry_id_table).val($("#delete_subtable_"+entry_id_table).val()+c+","):(reg=new RegExp(Math.abs(c)+","),$("#new_subtable_"+entry_id_table).val($("#new_subtable_"+entry_id_table).val().replace(reg,""))),$("#subtable_"+entry_id_table+"_"+c).fadeOut(function(){$(this).remove()})},newSubtable:function(a){"undefined"==typeof new_subtables&&(new_subtables=Array()),"undefined"==typeof new_subtables[a]?new_subtables[a]=1:new_subtables[a]++,$("#subtable_"+a+"__N_").before($("<div class='subtable' id='subtable_"+a+"_-"+new_subtables[a]+"'></div>").html($("#subtable_"+a+"__N_").html().replace(/_N_/g,"-"+new_subtables[a]))),$("#new_subtable_"+a).val($("#new_subtable_"+a).val()+new_subtables[a]+",")},newPop:function(a,b,c){a.indexOf("?")>-1?window.open(a+"&action=pop&pf="+b+"&pfdf="+c+"&pop=1","New","width=400,height=500"):window.open(a+"?action=pop&pf="+b+"&pfdf="+c+"&pop=1","New","width=400,height=500")},returnPop:function(a){window.opener.$("#"+a.pf+"_list").append("<option value='"+a.id+"'>"+a.pfdf+"</option>").val(a.id),window.close()}},lightning.video={players:{},init:function(){var a=this;for(var b in lightning.vars.videos){var c=lightning.vars.videos[b];if(c.call||(c.call=[]),c.playlist){var d=$("<ul>");for(var e in c.playlist)d.append('<li id="video_link_'+b+"_"+e+'" class="playlist_link">'+c.playlist[e].title+"</li>");$("#video_playlist_"+b).html(d),$(".video_playlist").on("click",".playlist_link",this.clickPlaylist)}c.call.beforeLoad?lightning.getMethodReference(c.call.beforeLoad)(b,function(){a.load(b)}):this.load(b)}},clickPlaylist:function(a){var b=a.currentTarget.id.replace("video_link_",""),c=b.match(/[0-9]+$/),d=b.replace("_"+c,"");lightning.video.players[d].dispose(),lightning.video.load(d,c,!0)},load:function(a,b,c){var d=lightning.vars.videos[a],e=$("#video_"+a);b||(b=0);var f=d.playlist?d.playlist[b]:d,g=f.controls||!f.hasOwnProperty("controls")&&(!d.hasOwnProperty("controls")||d.controls),h=d.hasOwnProperty("width")?d.width:640,i=d.hasOwnProperty("height")?d.width:320;if(f.mp4||f.ogg||f.webm){var j="<video id=video_player_"+a+' class="video-js vjs-default-skin" width="'+h+'" height="'+i+'" poster="'+(f.still?f.still:d.still?d.still:"")+'" '+(g?"controls":"")+" preload>";for(var k in{mp4:1,ogg:1,webm:1})f[k]&&(j+='<source src="'+f[k]+'" type="video/'+k+';">');j+="</video>"}else{var j="<audio id=video_player_"+a+' class="video-js vjs-default-skin" width="'+h+'" height="'+i+'" '+(g?"controls":"")+" preload>";for(var k in{mp3:1})f[k]&&(j+='<source src="'+f[k]+'" type="audio/'+k+';">');j+="</audio>"}if(e.append(j),videojs.autoSetup(),this.players[a]=videojs(document.getElementById("video_player_"+a),{width:"100%",controls:g}),d.classes&&$("#video_player_"+a).addClass(d.classes),(d.autoPlay||c)&&(this.players[a].play(),d.startTime&&d.startTime>0&&this.players[a].currentTime(d.startTime),d.call.afterLoad&&this.players[a].one("play",d.call.afterLoad)),d.call.onEnd&&this.players[a].on("ended",lightning.getMethodReference(d.call.onEnd)),d.call.onTime){var l=this;this.players[a].on("timeupdate",function(){l.timeCallback(l.players[a],lightning.vars.videos[a].call.onTime)})}},timeCallback:function(a,b){var c=a.currentTime();for(var d in b)c>=d&&(lightning.getMethodReference(b[d])(),delete b[d])}};