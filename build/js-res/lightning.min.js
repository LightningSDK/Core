function reset_field_value(a){"undefined"!=typeof CKEDITOR.instances[a]?CKEDITOR.instances[a].setData(table_data.defaults[a]):"undefined"!=typeof("#"+a).val?$("#"+a).val(table_data.defaults[a]):$("#"+a).html(table_data.defaults[a])}function tree_clear(a){var b=!1;$(".tree_column").each(function(){b&&$(this).remove(),$(this).attr("id").replace("tree_column_","")==a&&(b=!0)})}function tree_sub_click(){var a=$(this).closest(".tree_column").attr("id").replace("tree_column_","");if(tree_clear(a),$("#tree_column_"+a+" .selected").removeClass("selected"),$(this).addClass("selected"),$(this).hasClass("tree_column_directory")){var b=$(this).attr("id").replace("tree_node_","");$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"load_node",node_id:b},success:function(a){if("error"==a.status)alert(a.error);else{$("#tree_"+tree_data.tree_name).append("<div class='tree_column' id='tree_column_"+a.node_id+"'></div>"),$("#tree_column_"+a.node_id).append(tree_node_header(a));for(i in a.nodes)$("#tree_column_"+a.node_id).append(tree_node_string(a.nodes[i].node_name,a.nodes[i].node_id));for(i in a.items)$("#tree_column_"+a.node_id).append("<div class='tree_column_row tree_column_item' id='tree_obj_"+a.items[i].item_id+"'>"+a.items[i].item_title+"</div>");$("#tree_column_"+a.node_id+" .tree_column_row").on("click",tree_sub_click);var b=$("#tree_"+tree_data.tree_name).find(".tree_column").length*($("#tree_"+tree_data.tree_name).find(".tree_column").first().width()+1);$("#tree_"+tree_data.tree_name).css("width",b),$("#tree_"+tree_data.tree_name).parent().scrollLeft($("#tree_"+tree_data.tree_name).width()-$("#tree_"+tree_data.tree_name).parent().width())}}})}else{var b=$(this).attr("id").replace("tree_obj_","");$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"obj_detail",id:b},success:function(a){$("#tree_"+tree_data.tree_name).append("<div class='tree_column tree_column_obj' id='tree_column_obj_"+a.id+"'>"+a.html+"</div>");var b=$("#tree_"+tree_data.tree_name).find(".tree_column").length*($("#tree_"+tree_data.tree_name).find(".tree_column").first().width()+1);$("#tree_"+tree_data.tree_name).css("width",b),$("#tree_"+tree_data.tree_name).parent().scrollLeft($("#tree_"+tree_data.tree_name).width()-$("#tree_"+tree_data.tree_name).parent().width())}})}}function tree_add(a){var b=prompt("Enter a name for the new directory:"),c=$(a).closest(".tree_column");null!=b&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"add_node",node_id:c.attr("id").replace("tree_column_",""),name:b},success:function(b){if("ok"==b.status){var d=!1;c.find(".tree_column_row").each(function(){return $(this).html().replace(/\<span\>.*\<\/span\>/,"").toLowerCase()>b.name.toLowerCase()?($(this).before(tree_node_string(b.name,b.node_id)),$("#tree_node_"+b.node_id).on("click",tree_sub_click),d=!0,!1):void 0}),d||($(a).closest(".tree_column").append(tree_node_string(b.name,b.node_id)),$("#tree_node_"+b.node_id).on("click",tree_sub_click))}}})}function tree_delete(a){var b=$(a).closest(".tree_column").attr("id").replace("tree_column_",""),c=$("#tree_node_"+b).html().replace(/\<span\>.*\<\/span\>/,""),d=confirm("Are you sure you want to delete the node '"+c+"' ?");1==d&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"remove_node",node_id:b},success:function(a){"ok"==a.status?(parent_node=$("#tree_node_"+b).closest(".tree_column").attr("id").replace("tree_column_",""),$("#tree_node_"+b).remove(),tree_clear(parent_node)):alert("Error!")}})}function tree_rename(a){var b=$(a).closest(".tree_column").attr("id").replace("tree_column_",""),c=$("#tree_node_"+b).html().replace(/\<span\>.*\<\/span\>/,""),d=prompt("Enter a name for the new directory:",c);null!=d&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"rename_node",node_id:b,name:d},success:function(a){"ok"==a.status?$("#tree_node_"+b).html($("#tree_node_"+b).html().replace(c,d)):alert("Error!")}})}function tree_upload(a){var b=$(a).closest(".tree_column").attr("id").replace("tree_column_","");document.location=tree_data.action_file+"?node_id="+b+"&action=new"}function tree_node_string(a,b){return"<div class='tree_column_row tree_column_directory' id='tree_node_"+b+"'>"+a+"<span>&gt</span></div>"}function tree_node_header(a){return buttons="",buttons+=a.actions_before,1==a.upload&&(buttons+="<img src='/images/app/send_doc.png' title='Upload' onclick='tree_upload(this);' /> "),1==a.add&&(buttons+="<img src='/images/app/new2.png' title='New Folder' onclick='tree_add(this);' /> "),1==a.edit&&(buttons+="<img src='/images/app/pencil.png' title='Rename' onclick='tree_rename(this);' /> <img src='/images/app/remove2.png' title='Remove' onclick='tree_delete(this);' />"),"<div class='tree_column_header'><span>"+a.node_name+"</span>"+buttons+"</div>"}"undefined"==typeof lightning&&(lightning={}),lightning.admin={},lightning.admin.messageEditor={checkVars:function(){var a=$("#message_criteria_input_array").val();$.ajax({url:"/admin/mailing/messages",data:{action:"fields",criteria_list:a,message_id:$("#id").val()},dataType:"JSON",type:"GET",success:function(b){a=a.split(",");for(var c=0;c<a.length;c++)if(""!=a[c])for(var d in b.criteria){var e=b.criteria[d].criteria_id;if(b.criteria[d].criteria_id==a[c])for(var f in b.criteria[d].variables){var g=b.criteria[d].variables[f];if(0==$("#var_"+e+"_"+g).length){var h=b.criteria[d].values&&b.criteria[d].values[g]?b.criteria[d].values[g]:"";$("#message_criteria_box_"+a[c]).append('<div id="var_'+e+"_"+g+'" >'+g+': <input type="text" name="var_'+e+"_"+g+'" value="'+h+'"></div>')}}}},error:function(){alert("error")}})}},lightning.admin.messages={send:function(a){$("#message_status").html("Starting ...\n"),$(".mail_buttons").fadeOut();var b=0,c=this;$.ajax({url:"/admin/mailing/send?action=send-"+a+"&id="+lightning.vars.message_id,dataType:"text",data:{token:lightning.vars.token},type:"POST",stream:!0,xhrFields:{onprogress:function(a){var d=a.currentTarget.response;c.addContent("#message_status",d.substring(b)),b=d.length}},complete:function(){$(".mail_buttons").fadeIn()},error:function(){$(".mail_buttons").fadeIn()}})},addContent:function(a,b){var c=$(a);c.html(c.html()+b),c.animate({scrollTop:c.attr("scrollHeight")},500)}},lightning.ajax={jqueryAjax:function(){},init:function(){this.jqueryAjax=jQuery.ajax,jQuery.ajax=this.call},success:function(a,b){if("HTML"==a.dataType)return void(a.user_success?a.user_success(b):lightning.dialog.showContent(b));if(b&&b.messages&&b.messages.length>0){lightning.dialog.clear();for(var c in b.messages)lightning.dialog.add(b.messages[c],"message");lightning.dialog.show()}return b&&b.errors&&b.errors.length?void lightning.ajax.error(a,b):b&&b.status&&"redirect"==b.status?void(document.location=b.location):void(a.user_success&&a.user_success(b))},error:function(a,b){if(lightning.dialog.clear(),void 0==b)lightning.dialog.add("Communication Error","error"),lightning.dialog.show();else if("string"==typeof b)lightning.dialog.add(b,"error"),lightning.dialog.show();else if(b.errors)for(var c in b.errors)lightning.dialog.add(b.errors[c],"error"),lightning.dialog.show();else lightning.dialog.add('There was an error loading the page. Please reload the page. If the problem persists, please <a href="/contact">contact support</a>.',"error"),b.hasOwnProperty("status")&&lightning.dialog.add("HTTP: "+b.status,"error"),b.hasOwnProperty("responseText")&&!b.responseText.match(/<html/i)&&lightning.dialog.add(b.responseText,"error"),lightning.dialog.show();a.user_error&&a.user_error(b)},call:function(a){a.user_error=a.error,a.user_success=a.success,a.success=function(b){lightning.ajax.success(a,b)},a.error=function(b){lightning.ajax.error(a,b)},lightning.ajax.jqueryAjax(a)}},function(){var a;lightning.cms={edit:function(a){lightning.htmleditor.initEditor(a),$("#"+a.replace(/^cms_/,"cms_edit_")).hide(),$("#"+a.replace(/^cms_/,"cms_save_")).show()},save:function(b){lightning.dialog.showLoader("Saving..."),lightning.htmleditor.deactivateEditor(b),$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:b.replace(/^cms_/,""),token:lightning.vars.token,action:"save",content:$("#"+b).html()},success:function(a){$("#"+b.replace(/^cms_/,"cms_edit_")).show(),$("#"+b.replace(/^cms_/,"cms_save_")).hide(),lightning.dialog.clear(),lightning.dialog.add("Saved!","message")},error:function(){a.edit(b),lightning.dialog.clear(),lightning.dialog.add("The content could not be saved, please try again!","error")}})},initImage:function(){$(".cms_edit_image").on("click",function(b){var c=$(b.target).attr("id").replace(/^cms_edit_/,"");a.editImage(c)}),$(".cms_save_image").on("click",function(b){var c=$(b.target).attr("id").replace(/^cms_save_/,"");a.saveImage(c)}),$(".imagesCSS").keyup(function(){var a=$(this),b=a.attr("id").replace("_class",""),c=a.attr("name")+" "+a.val();$("#"+b).removeClass().addClass(c)})},editImage:function(a){$("#cms_save_"+a).show(),$("#cms_"+a+"_class").show(),lightning.fileBrowser.openSelect("lightning-cms",a)},imageSelected:function(a,b){$("#cms_"+b).attr("src",a)},saveImage:function(a){lightning.dialog.showLoader("Saving..."),$("#cms_save_"+a).hide(),$("#cms_"+a+"_class").hide(),$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:a,"class":$("#cms_"+a+"_class").val(),token:lightning.vars.token,action:"save-image",content:$("#cms_"+a).attr("src").replace(lightning.vars.cms.baseUrl,"")},success:function(){lightning.dialog.clear(),lightning.dialog.add("Saved!","message")},error:function(){$("#cms_save_"+a).show(),$("#cms_"+a+"_class").show(),lightning.dialog.clear(),lightning.dialog.add("The content could not be saved, please try again!","error")}})},initPlain:function(){$(".cms_edit_plain").on("click",function(b){var c=$(b.target).attr("id").replace(/^cms_edit_/,"");a.editPlain(c)}),$(".cms_save_plain").on("click",function(b){var c=$(b.target).attr("id").replace(/^cms_save_/,"");a.savePlain(c)})},editPlain:function(a){$("#cms_edit_"+a).hide(),$("#cms_save_"+a).show(),$("#cms_display_"+a).hide(),$("#cms_"+a).show()},savePlain:function(a){lightning.dialog.showLoader("Saving..."),$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:a,token:lightning.vars.token,action:"save",content:$("#cms_"+a).val()},success:function(){$("#cms_edit_"+a).show(),$("#cms_save_"+a).hide(),$("#cms_"+a).hide(),$("#cms_display_"+a).html($("#cms_"+a).val()).show(),lightning.dialog.clear(),lightning.dialog.add("Saved!","message")},error:function(){lightning.dialog.clear(),lightning.dialog.add("The content could not be saved, please try again!","error")}})},initDate:function(){$(".cms_edit_date").on("click",function(b){var c=$(b.target).attr("id").replace(/^cms_edit_/,"");a.editDate(c)}),$(".cms_save_date").on("click",function(b){var c=$(b.target).attr("id").replace(/^cms_save_/,"");a.saveDate(c)})},editDate:function(a){$("#cms_edit_"+a).hide(),$("#cms_save_"+a).show(),$("#cms_"+a).show()},saveDate:function(a){$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{id:a,key:$("#cms_key_"+a).val(),column:$("#cms_column_"+a).val(),table:$("#cms_table_"+a).val(),token:lightning.vars.token,action:"update-date",date_m:$("#cms_"+a+"_m").val(),date_d:$("#cms_"+a+"_d").val(),date_y:$("#cms_"+a+"_y").val()},success:function(a){var b="";for(var c in a.errors)b+=a.error[c]+" ";""==b&&(b="Could not save: Unknown error.")},error:function(){$("#cms_edit_"+a).show(),$("#cms_save_"+a).hide(),$("#cms_"+a).hide();var b=$("#cms_"+a+"_m").val()+"/"+$("#cms_"+a+"_d").val()+"/"+$("#cms_"+a+"_y").val();$("#date_"+a).text(b)}})}},a=lightning.cms}(),function(){var a;lightning.dialog={originalScroll:0,newPosition:0,dialogBox:!1,dialogBoxLoader:void 0,dialogBoxInner:void 0,init:function(){a.dialogBox||($('<div class="reveal-modal" id="dialog_box" data-reveal aria-hidden="true" role="dialog"><a class="close-reveal-modal"><i class="fa fa-close"></i></a><div class="table_data clear border_top"><div class="inner" id="dialog_box_inner"><div class="messenger error"><ul></ul></div><div class="messenger warning"><ul></ul></div><div class="messenger message"><ul></ul></div><div class="content"><ul></ul></div></div><div class="inner" id="dialog_box_loader"></div></div></div>').prependTo("body"),a.dialogBox=$("#dialog_box"),a.dialogBoxLoader=$("#dialog_box_loader"),a.dialogBoxInner=$("#dialog_box_inner"),a.clear())},hide:function(){a.init(),a.dialogBox.foundation("reveal","close")},show:function(){a.init(),a.dialogBox.foundation("reveal","open")},showLoader:function(b){a.init(),a.clear(),a.setContent('<p align="center"><img src="/images/lightning/cog-spinner.gif" class="loader_image"></p>'),"undefined"!=typeof b&&a.addContent('<p align="center">'+b+"</p>"),a.show()},showURL:function(b){a.init(),a.showLoader(),$.ajax({dataType:"HTML",url:b,success:function(b){a.setContent(b),a.show()}})},showContent:function(b){a.init(),a.setContent(b),a.show()},clear:function(){a.init(),a.dialogBoxInner.find(".content").empty().hide(),a.dialogBoxInner.find(".error ul").empty(),a.dialogBoxInner.find(".error").hide(),a.dialogBoxInner.find(".warning ul").empty(),a.dialogBoxInner.find(".warning").hide(),a.dialogBoxInner.find(".message ul").empty(),a.dialogBoxInner.find(".message").hide()},addContent:function(b){a.init(),b=$(b).hide(),a.dialogBoxInner.find(".content").append(b),b.fadeIn("fast"),a.dialogBoxInner.fadeIn("fast"),a.dialogBoxInner.find(".content").fadeIn("fast")},add:function(b,c){a.init(),b=$("<li>"+b+"</li>");var d="message"==c?".message":"warning"==c?".warning":".error";a.dialogBoxLoader.fadeOut("fast",function(){a.dialogBoxInner.find(d).is(":visible")?(b.hide(),a.dialogBoxInner.find(d+" ul").append(b),b.fadeIn("fast")):(a.dialogBoxInner.find(d+" ul").append(b),a.dialogBoxInner.is(":visible")?a.dialogBoxInner.find(d).fadeIn("fast"):a.dialogBoxInner.find(d).show()),a.dialogBoxInner.fadeIn("fast")})},setContent:function(b){a.init(),a.dialogBoxInner.hide(),a.clear(),a.dialogBoxInner.find(".content").html(b).show(),a.dialogBox.foundation("reveal","open"),a.dialogBoxInner.fadeIn("fast")}},a=lightning.dialog}(),lightning.fileBrowser={type:null,field:null,elf:null,funcNum:null,init:function(){var a=document.location.search.substring(1).split("&");for(var b in a){var c=a[b].split("=");"type"==c[0]&&(lightning.fileBrowser.type=c[1]),"field"==c[0]&&(lightning.fileBrowser.field=c[1]),"CKEditorFuncNum"==c[0]&&(lightning.fileBrowser.funcNum=c[1]),"url"==c[0]&&(lightning.fileBrowser.urlType=c[1]),"web_root"==c[0]&&(lightning.fileBrowser.webRoot=unescape(c[1]))}lightning.fileBrowser.elf=$("#elfinder").elfinder({url:"/elfinder",closeOnEditorCallback:!0,getFileCallback:lightning.fileBrowser.select}).elfinder("instance")},select:function(a,b){var c=a.url;switch("full"==lightning.fileBrowser.urlType&&(c=(lightning.fileBrowser.webRoot+"/"+c).replace(/([^:])\/\/+/g,"$1/")),lightning.fileBrowser.type){case"ckeditor":window.opener.CKEDITOR.tools.callFunction(lightning.fileBrowser.funcNum,c),window.close();break;case"tinymce":parent.tinymce.activeEditor.windowManager.getParams().setUrl(c);var d=parent.tinymce.activeEditor.windowManager.windows[0];d.find("#src").fire("change"),parent.tinymce.activeEditor.windowManager.close();break;case"lightning-field":window.opener.lightning.fileBrowser.fieldSelected(c,lightning.fileBrowser.field),window.close();break;case"lightning-cms":window.opener.lightning.cms.imageSelected(c,lightning.fileBrowser.field),window.close()}},openSelect:function(a,b,c){switch("undefined"==typeof c&&(c="absolute&web_root="+escape(lightning.vars.web_root)),lightning.fileBrowser.type||lightning.vars.fileBrowser.type){case"elfinder":window.open("/js/elfinder/elfinder.html?type="+a+"&field="+b+"&url="+c,"Image Browser","");break;case"ckfinder":CKFinder.popup({basePath:lightning.vars.cms.basepath,chooseFiles:!0,chooseFilesOnDblClick:!0,onInit:function(a){a.on("files:choose",function(a){var b=a.data.files.first();self.updateImage(id,b.getUrl())}),a.on("file:choose:resizedImage",function(a){self.updateImage(id,a.data.resizedUrl)})}})}},fieldSelected:function(a,b){var c=$("#file_browser_image_"+b);c.length>0&&c.prop("src",a).show(),$("#"+b).val(a)},clear:function(a){var b=$("#file_browser_image_"+a);b.length>0&&b.prop("src","").hide(),$("#"+a).val("")}},lightning.forms={init:function(){}},function(){var a;lightning.htmleditor={editors:{},init:function(){for(var b in lightning.vars.htmleditors)if("tinymce"==lightning.vars.htmleditors[b].editor_type)lightning.vars.htmleditors[b].setup=a.tinymceSetup,lightning.vars.htmleditors[b].browser&&(lightning.vars.htmleditors[b].file_browser_callback=a.imageBrowser),lightning.vars.htmleditors[b].startup&&a.initEditor(b);else if("ckeditor"==lightning.vars.htmleditors[b].editor_type){(function(b){CKEDITOR.scriptLoader.queue(CKEDITOR.getUrl("config.js"),function(){"function"==typeof CKEDITOR.editorConfig&&CKEDITOR.editorConfig(CKEDITOR.config),lightning.vars.htmleditors[b].hasOwnProperty("plugins")?lightning.vars.htmleditors[b].plugins=lightning.vars.htmleditors[b].plugins.replace(/\*/,CKEDITOR.config.plugins):lightning.vars.htmleditors[b].plugins=CKEDITOR.config.plugins,lightning.vars.htmleditors[b].hasOwnProperty("fullPage")&&lightning.vars.htmleditors[b].fullPage&&(lightning.vars.htmleditors[b].plugins=lightning.vars.htmleditors[b].plugins.replace("divarea","")),lightning.vars.htmleditors[b].startup&&a.initEditor(b)})})(b)}$(".html_editor_presave").closest("form").submit(function(){$(this).find(".html_editor_presave").each(function(){var b=$(this),c=$(this).prop("id").replace("save_","");"ckeditor"==lightning.vars.htmleditors[c].editor_type&&b.val(a.getContent(c))})})},getContent:function(b){return"ckeditor"==lightning.vars.htmleditors[b].editor_type?a.editors[b].getData():void 0},initEditor:function(b){"tinymce"==lightning.vars.htmleditors[b].editor_type?tinymce.init(lightning.vars.htmleditors[b]):"ckeditor"==lightning.vars.htmleditors[b].editor_type&&($("#"+b).attr("contenteditable","true"),a.editors[b]=CKEDITOR.inline(b,lightning.vars.htmleditors[b]))},deactivateEditor:function(b){if("tinymce"==lightning.vars.htmleditors[b].editor_type)for(var c in tinymce.editors)tinymce.editors[c].id==b&&tinymce.editors[c].remove();else"ckeditor"==lightning.vars.htmleditors[b].editor_type&&($("#"+b).attr("contenteditable","false"),a.editors[b].destroy())},tinymceSetup:function(a){a.addButton("columns",{type:"menubutton",text:"Columns",icon:!1,menu:[{text:"2 Columns",onclick:function(){a.insertContent('<div class="row"><div class="small-12 medium-6 column"><p>Column 1</p></div><div class="small-12 medium-6 column"><p>Column 2</p></div></div>')}},{text:"3 Columns",onclick:function(){a.insertContent('<div class="row"><div class="small-12 medium-4 column"><p>Column 1</p></div><div class="small-12 medium-4 column"><p>Column 2</p></div><div class="small-12 medium-4 column"><p>Column 3</p></div></div>')}},{text:"4 Columns",onclick:function(){a.insertContent('<div class="row"><div class="small-12 medium-3 column"><p>Column 1</p></div><div class="small-12 medium-3 column"><p>Column 2</p></div><div class="small-12 medium-3 column"><p>Column 3</p></div><div class="small-12 medium-3 column"><p>Column 4</p></div></div>')}}]}),a.addButton("yt",{type:"button",text:"YT",icon:!1,onclick:function(){a.insertContent('{{youtube id="" flex=true widescreen=true}}')}})},imageBrowser:function(a,b,c,d){return tinymce.activeEditor.windowManager.open({file:"/elfinder/elfinder.html?type=tinymce",title:"Image Browser",width:900,height:450,resizable:"yes"},{setUrl:function(b){d.document.getElementById(a).value=b}}),!1}},a=lightning.htmleditor}(),lightning.jsoneditor={init:function(){for(var a in lightning.vars.jsoneditor){var b=document.getElementById(a),c={};lightning.vars.jsoneditor[a].hasOwnProperty("options")&&(c=lightning.vars.jsoneditor[a].options),c.hasOwnProperty("mode")||(c.mode="tree"),lightning.vars.jsoneditor[a].editor=new JSONEditor(b,c),lightning.vars.jsoneditor[a].editor.set(lightning.vars.jsoneditor[a].json)}$(".jsoneditor_presave").closest("form").submit(function(){$(this).find(".jsoneditor_presave").each(function(){var a=$(this),b=$(this).prop("id").replace(/_data$/,"");a.val(JSON.stringify(lightning.vars.jsoneditor[b].editor.get()))})})}},lightning.getMethodReference=function(a){var b=a.split("."),c=window;for(var d in b)c=c[b[d]];return c},lightning.format={sizes:["B","KB","MB","GB","TB","PB"],dataSize:function(a){for(var b=a,c=0;b>=1e3;)b/=1024,c++;return void 0==this.sizes[0]?"Really Big":b.toPrecision(3)+this.sizes[c]}},lightning.startup={init:function(){this.initForms(),this.initNav(),lightning.ajax.init(),lightning.dialog.init(),lightning.splitTest.init()},initNav:function(){var a=lightning.get("menu_context");a&&$("nav ."+a).addClass("active")},initForms:function(){$(".captcha_container").closest("form").submit(function(){var a=$(this);return a&&function(){var a=0!=grecaptcha.getResponse().length;return $("#captcha_abide").val(a?1:""),a}()})}},lightning.require=function(a,b){"string"==typeof a&&(a=[a]);var c=a.length,d=0;for(var e in a){var f=document.createElement("script");f.src=a[e],f.type="text/javascript",f.async="true",f.onload=f.onreadystatechange=function(){var a=this.readyState;if((!a||"complete"==a||"loaded"==a)&&(d++,d==c))try{b()}catch(e){console.error(e)}};var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(f,g)}},lightning.get=function(a){if(!a)return null;a=a.split(".");var b=lightning.vars;for(var c in a){if(!b.hasOwnProperty(a[c]))return null;b=b[a[c]]}return b},lightning.parsed_query=null,lightning.parsed_hash=null,lightning.getFromURL=function(a,b){var c="parsed_"+a;if(null==lightning[c]){var d=document.location[a].substring(1).split("&");lightning[c]={};for(var e in d)if(0!=d[e].length){var f=d[e].split("=",2);lightning[c][f[0]]=f[1]}}return lightning[c].hasOwnProperty(b)?lightning[c][b]:null},lightning.query=function(a){return lightning.getFromURL("search",a)},lightning.hash=function(a){return lightning.getFromURL("hash",a)},lightning.modules={},lightning.multiplier={init:function(){var a=this;$(".multiplier").each(function(){$(this).on("click",".multiplier_add",null,function(b){a.addOption(b.target)}),$(this).on("click",".multiplier_remove",null,function(b){a.removeOption(b.target)}),$(this).append('<input class="multiplier_count" value="0" type="hidden" />'),$(this).find(".template").hide(),a.addOption(this)})},addOption:function(a){var b=$(a).closest(".multiplier"),c=b.find(".template").html(),d=b.find(".multiplier_count").val(),e=$('<div class="item"></div>').append(c.replace(/%/g,d+1));b.find(".multiplier_count").val(d+1),b.append(e),this.adjustControls(b)},removeOption:function(a){$(a).closest(".item").remove(),this.adjustControls($(a).closest(".multiplier"))},adjustControls:function(a){a.find(".multiplier_add").hide(),a.find(".multiplier_add").last().show(),a.find(".multiplier_remove").show()}},function(){var a;lightning.page={edit:function(){$(".page_edit").show(),$(".page_edit_links").hide(),$("#page_display").html($("#save_page_display").val()),lightning.htmleditor.initEditor("page_display")},save:function(){$("#save_button").hide(),lightning.dialog.showLoader("Saving...");var b={page_id:$("#page_id").val(),token:$("#token").val(),action:"save",title:$("#page_title").val(),url:$("#page_url").val(),menu_context:$("#page_menu_context").val(),description:$("#page_description").val(),keywords:$("#page_keywords").val(),sitemap:$("#page_sitemap").is(":checked")?1:0,layout:$("#page_layout").val(),page_body:lightning.htmleditor.getContent("page_display")};$.ajax({url:"/page",type:"POST",dataType:"json",data:b,success:function(a){lightning.htmleditor.deactivateEditor("page_display"),$(".page_edit").hide(),$(".page_edit_links").show(),$("#page_display").attr("contentEditable","false"),$("#page_id").val(a.page_id),$("#page_url").val(a.url),document.title=a.title,$("#page_header").html(a.title),$("#save_page_display").val(a.page_body),$("#page_display").html(a.body_rendered),lightning.dialog.clear(),lightning.dialog.add("Saved!","message")},error:function(){lightning.dialog.clear(),lightning.dialog.add("The page could not be saved, please try again!","error"),a.edit()}})}},a=lightning.page}(),lightning.social={google:{signin:function(){lightning.require("https://apis.google.com/js/platform.js",function(){gapi.load("auth2",function(){var a=gapi.auth2.getAuthInstance()||gapi.auth2.init({client_id:lightning.vars.social.google.client_id});response=a.signIn().then(function(a){if(lightning.vars.social.authorize){for(var b in a)if("object"==typeof a[b]&&a[b].hasOwnProperty("access_token")){var c={access_token:a[b].access_token,created:a[b].first_issued_at,expires_in:a[b].expires_in};return void lightning.social.signinComplete("google","auth",JSON.stringify(c))}}else lightning.social.signinComplete("google","id",a.getAuthResponse().id_token)})})})},signout:function(){lightning.require("https://apis.google.com/js/platform.js",function(){gapi.load("auth2",function(){gapi.auth2.getAuthInstance()||gapi.auth2.init({client_id:lightning.vars.social.google.client_id});lightning.social.google.finalizeLogout()})})},finalizeLogout:function(){var a=gapi.auth2.getAuthInstance(),b=!1;a.signOut().then(function(){b=!0,window.location.href="/user?action=logout"}),setTimeout(function(){b||lightning.social.google.finalizeLogout()},500)}},facebook:{init:function(){},signin:function(){if(!lightning.vars.social.facebook.appid)return void console.log("Missing facebook app ID");FB.init({appId:lightning.vars.social.facebook.appid,cookie:!0,xfbml:!1,version:"v2.2"});var a={},b=lightning.get("social.facebook.scope");b&&(a.scope=b),FB.login(lightning.social.facebook.signinComplete,a)},signinComplete:function(a){"connected"===a.status?lightning.vars.social.authorize?lightning.social.signinComplete("facebook","auth",a.authResponse.accessToken):lightning.social.signinComplete("facebook","id",a.authResponse.signedRequest):console.log("could not sign in to facebook")},signout:function(){}},twitter:{signin:function(){window.location.href=lightning.vars.social.twitter.signin_url}},initShare:function(){$(".social-share").on("click","div",lightning.social.shareClick)},shareClick:function(){var a=$(this),b=a.closest(".social-share").data("url");a.is(".facebook")?lightning.social.sharePop("http://www.facebook.com/sharer.php?s=100&p[url]="+b):a.is(".twitter")?lightning.social.sharePop("https://twitter.com/intent/tweet?url="+b):a.is(".google")?lightning.social.sharePop("https://plus.google.com/share?url="+b):a.is(".linkedin")&&lightning.social.sharePop("http://www.linkedin.com/shareArticle?mini=true&url="+b)},sharePop:function(a){var b=350,c=520,d=screen.height/2-b/2,e=screen.width/2-c/2;window.open(a,"sharer","top="+d+",left="+e+",toolbar=0,status=0,width="+c+",height="+b)},initLogout:function(a){$(".logout_button").on("click",function(b){b.preventDefault(),lightning.social[a].signout()})},initLogin:function(){$(".social-signin").on("click",function(){$(this).is(".google")&&lightning.social.google.signin(),$(this).is(".facebook")&&lightning.social.facebook.signin(),$(this).is(".twitter")&&lightning.social.twitter.signin()})},signinComplete:function(a,b,c){var d=lightning.get("social.signin_url");null==d&&(d="/user");var e=$('<form method="post" style="display:none">').attr("action",d);e.append('<input type="hidden" name="token" value="'+lightning.vars.token+'">');var f=lightning.get("social.login_redirect");f&&e.append('<input type="hidden" name="redirect" value="'+f+'">'),e.append('<input type="hidden" name="action" value="'+a+'-login">'),e.append($('<input type="hidden" name="'+b+'-token">').val(c)),e.submit()}},lightning.splitTest={init:function(){if(lightning.vars.hasOwnProperty("splitTest"))for(var a in lightning.vars.splitTest)ga("send",{hitType:"event",eventCategory:a,eventAction:lightning.vars.splitTest[a],eventLabel:"Split Test"})}},lightning.stats={charts:{},loadData:function(){var a={sets:[]};$("#stats_controls select").not("#tracker_\\%").each(function(){var b=$(this).attr("id").replace("tracker_","");a.sets.push({tracker:$("#tracker_"+b).val(),sub_id:$("#sub_id_"+b).val()})}),this.getTrackerStats(a,this.updateStats)},drawData:function(a,b){var c=document.getElementById(a).getContext("2d"),d=lightning.vars.chart[a].renderer;lightning.stats.charts[a]&&lightning.stats.charts[a].destroy(),lightning.stats.charts[a]=new Chart(c)[d](b,{responsive:!0,datasetFill:!1})},updateTotals:function(a,b){var c=$("#chart_totals_"+a);if(1==c.length)if(c.empty(),b.datasets)for(var d in b.datasets){var e=0;if(b.datasets[d].total_average)e=b.datasets[d].total_average;else for(var f in b.datasets[d].data)e+=parseInt(b.datasets[d].data[f]);var g="";if(lightning.vars.chart[a].params.diff){difference=e-b.datasets[d].previous;var h=difference<0?"red":"green",i=difference<0?"":"+",j=0!=b.datasets[d].previous?(100*difference/b.datasets[d].previous).toFixed(1):0;g='<span class="strong '+h+'">'+i+difference+" ("+j+"%)</span>"}lightning.vars.chart[a].params.number_format&&"money"==lightning.vars.chart[a].params.number_format&&(e="$"+e.toFixed(2)),c.append($("<li>"+(b.datasets[d].label?b.datasets[d].label:d)+": "+e+" "+g+"</li>"))}else{var k=0;for(var d in b)k+=b[d].value;c.append($("<li>Total: "+k+"</li>"))}},getTrackerStats:function(a,b,c){b.action="trackerStats",$.ajax({type:"GET",url:"/admin/tracker",dataType:"JSON",data:b,success:c})},getParameters:function(a){if(lightning.vars.chart[a].params){var b={};for(var c in lightning.vars.chart[a].params){var d=lightning.vars.chart[a].params[c];d.source?b[c]=$("#chart_controls_"+a+" #"+d.source).val():d.value&&(b[c]=d.value)}return b}return{}},updateStats:function(a){var b=this,c=this.getParameters(a);c.action="get-data",c.id=a,$.ajax({type:"GET",url:lightning.vars.chart[a].url,dataType:"JSON",data:c,success:function(c){b.drawData(a,c.data),b.updateTotals(a,c.data)}})},init:function(){var a=this;$(".chart_controls input, .chart_controls select").change(function(b){var c=$(b.target).closest(".chart_controls").attr("id").replace("chart_controls_","");a.updateStats(c)});for(var b in lightning.vars.chart)lightning.vars.chart[b].data?(a.drawData(b,lightning.vars.chart[b].data),a.updateTotals(b,lightning.vars.chart[b].data)):lightning.vars.chart[b].ajax&&a.updateStats(b)}},lightning.table={init:function(){$(".add_image").on("click",lightning.table.clickAddImage),$(".linked_images").on("click",".remove",lightning.table.removeLinkedImage);var a=this,b=$("#table_search");b.keyup(function(){a.search(b)}),$("table.table_form_table").on("click",".remove-link",function(b){var c=$(b.target);a.removeLink(c.data("link"),c.data("link-item"))}).on("click",".add-link",function(b){a.addLink($(b.target).data("link"))})},click:function(a){var b=a.currentTarget.id;if("INPUT"!=a.target.tagName&&void 0!=table_data.rowClick)switch(table_data.rowClick.type){case"url":document.location=table_data.rowClick.url+b;break;case"action":document.location=lightning.table.createUrl(table_data.rowClick.action,b)}},createUrl:function(a,b){var c=[];if(c.push("action="+encodeURIComponent(a)),c.push("id="+encodeURIComponent(b)),table_data.table&&c.push("table="+encodeURIComponent(table_data.table)),table_data.parent_link&&c.push(table_data.parent_link+"="+encodeURIComponent(table_data.parent_id)),table_data.vars)for(var d in table_data.vars)null!=table_data.vars[d]&&c.push(d+"="+encodeURIComponent(table_data.vars[d]));return url="?"+c.join("&")},selectAll:function(a){$(".taf_"+a).prop("checked",$("#taf_all_"+a).is(":checked"))},searchTimeout:null,searchIndex:0,searchIndexDisplayed:0,search:function(a){var b=$(a).val();this.searchIndex++,clearTimeout(this.searchTimeout);var c=this;this.searchTimeout=setTimeout(function(){table_data.vars.ste=b,$.ajax({url:table_data.action_file,type:"GET",dataType:"json",data:{ste:b,i:c.searchIndex,action:"search"},success:function(a){a.d>c.searchIndexDisplayed&&(c.searchIndexDisplayed=a.d,$(".table_list").html(a.html))}})},500)},addLink:function(a){
var b=$("#"+a+"_list"),c=b.val(),d=$("#"+a+"_list option:selected").text();if(0!=c||""!=d){var e=new RegExp("(^|,)"+c+","),f=$("#"+a+"_input_array");if(null==f.val().match(e)){f.val(f.val()+c+","),$("#"+a+"_list_container").append($('<div class="'+a+'_box table_link_box_selected" id="'+a+"_box_"+c+'">'+d+' <i class="remove-link fa fa-close" data-link="'+a+'" data-link-item="'+c+'"></i></div>'));var g=lightning.get("table.linkProcess");for(var h in g)lightning.getMethodReference(g[h])()}}},removeLink:function(a,b){$("#"+a+"_box_"+b).remove();var c=$("#"+a+"_input_array"),d=c.val(),e=new RegExp("[\\^,]"+b+",","i");d=d.replace(e,","),e=new RegExp("^"+b+",","i"),d=d.replace(e,""),c.val(d)},clickAddImage:function(a){var b=a.target.id.replace("add_image_","");CKFinder.popup({basePath:lightning.vars.table.links[b].web_location,chooseFiles:!0,chooseFilesOnDblClick:!0,onInit:function(a){a.on("files:choose",function(a){var c=a.data.files.first();lightning.table.addImageCallback(b,c.getUrl())}),a.on("file:choose:resizedImage",function(a){lightning.table.addImageCallback(b,a.data.resizedUrl)})}})},addImageCallback:function(a,b){$("#linked_images_"+a).append('<span class="selected_image_container"><input type="hidden" name="linked_images_'+a+'[]" value="'+b+'"><span class="remove">X</span><img src="'+b+'" /></span>')},removeLinkedImage:function(a){$(a.target).closest(".selected_image_container").remove()},autocomplete:function(){var a=$(this).attr("id");table_data.fields||(table_data.fields={},table_data.fields[a]={});var b=$(this).val();b.length>=2&&(!table_data.fields[a].last_fetch||table_data.fields[a].last_fetch!=b)&&(table_data.fields[a].last_fetch=b,$.ajax({url:table_data.action_file,type:"get",dataType:"json",data:{action:"autocomplete",field:a,st:table_data.fields[a].last_fetch},success:function(c){b==table_data.fields[a].last_fetch&&lightning.table.autocompleteDropdown(a,c.results)},error:function(){alert("error")}}))},autocompleteDropdown:function(a,b){$(".table_container").each(function(){$(this).attr("id")!="table_container_"+a?$(this).remove():$("#list_"+a).empty()}),0==$(".table_container").length&&$("#"+a).after("<div id='table_container_"+a+"' class='table_container'><div id='list_"+a+"'></div></div>");var c=0;for(var d in b)$("#list_"+a).append('<span id="'+a+"_"+d+'" >'+b[d]+"</span>"),c++;$("#list_"+a+" span").on("click",lightning.table.setAutocompleteSelection)},setAutocompleteSelection:function(a){var b=$(this).attr("id").split("_"),c=b.pop(),d=b.join("_");$("#table_container_"+d).remove(),$("#"+d).val(c)},deleteSubtable:function(a){var b=$(a).closest("div").attr("id").replace("subtable_",""),c=b.split("_");c=c[c.length-1],entry_id_table=b.replace("_"+c,""),parseInt(c)>0?$("#delete_subtable_"+entry_id_table).val($("#delete_subtable_"+entry_id_table).val()+c+","):(reg=new RegExp(Math.abs(c)+","),$("#new_subtable_"+entry_id_table).val($("#new_subtable_"+entry_id_table).val().replace(reg,""))),$("#subtable_"+entry_id_table+"_"+c).fadeOut(function(){$(this).remove()})},newSubtable:function(a){"undefined"==typeof new_subtables&&(new_subtables=Array()),"undefined"==typeof new_subtables[a]?new_subtables[a]=1:new_subtables[a]++,$("#subtable_"+a+"__N_").before($("<div class='subtable' id='subtable_"+a+"_-"+new_subtables[a]+"'></div>").html($("#subtable_"+a+"__N_").html().replace(/_N_/g,"-"+new_subtables[a]))),$("#new_subtable_"+a).val($("#new_subtable_"+a).val()+new_subtables[a]+",")},newPop:function(a,b,c){a.indexOf("?")>-1?window.open(a+"&action=pop&pf="+b+"&pfdf="+c+"&pop=1","New","width=400,height=500"):window.open(a+"?action=pop&pf="+b+"&pfdf="+c+"&pop=1","New","width=400,height=500")},returnPop:function(a){window.opener.$("#"+a.pf+"_list").append("<option value='"+a.id+"'>"+a.pfdf+"</option>").val(a.id),window.close()},"export":function(a){var b=$('[name="table_search"]').val();console.log(a);var c=$(a).attr("href");""!=b&&(c+="&ste="+b),window.location=c}},lightning.video={players:{},init:function(){var a=this;for(var b in lightning.vars.videos){var c=lightning.vars.videos[b];if(c.call||(c.call=[]),c.playlist){var d=$("<ul>");for(var e in c.playlist)d.append('<li id="video_link_'+b+"_"+e+'" class="playlist_link">'+c.playlist[e].title+"</li>");$("#video_playlist_"+b).html(d),$(".video_playlist").on("click",".playlist_link",this.clickPlaylist)}c.call.beforeLoad?lightning.getMethodReference(c.call.beforeLoad)(b,function(){a.load(b)}):this.load(b)}},initYouTube:function(){$(".youtube:not(.initted)").each(function(){var a="//i.ytimg.com/vi/"+this.id+"/maxresdefault.jpg",b="//i.ytimg.com/vi/"+this.id+"/hqdefault.jpg",c=new Image,d=$(this);c.onerror=function(){$(this).css("background-image","url("+b+")")},c.onload=function(){this.width<=120?d.css("background-image","url("+b+")"):d.css("background-image","url("+a+")")},c.src=a,d.append($("<div/>",{"class":"play"})),d.data("autoplay")?lightning.video.playYouTube(d):$(document).delegate("#"+this.id,"click",function(){lightning.video.playYouTube($(this))}),d.addClass("initted")})},playYouTube:function(a){var b=$(a),c="https://www.youtube.com/embed/"+b.prop("id")+"?autoplay=1&autohide=1&modestbranding=0&showinfo=0&rel=0";b.data("params")&&(c+="&"+b.data("params"));var d=$("<iframe/>",{frameborder:"0",src:c,width:"100%",height:"100%"});b.replaceWith(d)},clickPlaylist:function(a){var b=a.currentTarget.id.replace("video_link_",""),c=b.match(/[0-9]+$/),d=b.replace("_"+c,"");lightning.video.players[d].dispose(),lightning.video.load(d,c,!0)},load:function(a,b,c){var d=lightning.vars.videos[a],e=$("#video_"+a);b||(b=0);var f,g=d.playlist?d.playlist[b]:d,h=g.controls||!g.hasOwnProperty("controls")&&(!d.hasOwnProperty("controls")||d.controls),i=d.hasOwnProperty("width")?d.width:640,j=d.hasOwnProperty("height")?d.width:320;if(g.mp4||g.ogg||g.webm){f="<video id=video_player_"+a+' class="video-js vjs-default-skin" width="'+i+'" height="'+j+'" poster="'+(g.still?g.still:d.still?d.still:"")+'" '+(h?"controls":"")+" preload>";for(var k in{mp4:1,ogg:1,webm:1})g[k]&&(f+='<source src="'+g[k]+'" type="video/'+k+';">');f+="</video>"}else{f="<audio id=video_player_"+a+' class="video-js vjs-default-skin" width="'+i+'" height="'+j+'" '+(h?"controls":"")+" preload>";for(var k in{mp3:1})g[k]&&(f+='<source src="'+g[k]+'" type="audio/'+k+';">');f+="</audio>"}e.append(f),this.players[a]=videojs(document.getElementById("video_player_"+a),{width:"100%",controls:h}),d.classes&&$("#video_player_"+a).addClass(d.classes),(d.autoPlay||c)&&(this.players[a].play(),d.startTime&&d.startTime>0&&this.players[a].currentTime(d.startTime),d.call.afterLoad&&this.players[a].one("play",d.call.afterLoad)),d.call.onEnd&&this.players[a].on("ended",lightning.getMethodReference(d.call.onEnd));var l=this;d.call.onTime&&this.players[a].on("timeupdate",function(){l.timeCallback(l.players[a],lightning.vars.videos[a].call.onTime)}),d.hasOwnProperty("analytics_events")||(d.analytics_events=!1);var m=0;d.analytics_events&&(this.players[a].on("ended",function(){lightning.video.track(a,"ended")}),this.players[a].on("pause",function(){lightning.video.track(a,"paused",l.players[a].currentTime(),!0)}),this.players[a].on("play",function(){lightning.video.track(a,"played",l.players[a].currentTime(),!0)}),this.players[a].on("timeupdate",function(){var b=parseInt(l.players[a].currentTime());m!=b&&b%10==0&&(m=b,lightning.video.track(a,"watching",b))}))},track:function(a,b,c,d){void 0==d&&(d=!1),ga("send","event","video."+a,b,"time",c,{nonInteraction:d?1:0})},timeCallback:function(a,b){var c=a.currentTime();for(var d in b)c>=d&&(lightning.getMethodReference(b[d])(),delete b[d])}};