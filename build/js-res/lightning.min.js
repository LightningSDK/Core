"undefined"==typeof lightning&&(lightning={});
lightning.admin={},lightning.admin.messageEditor={checkVars:function(){var a=$("#message_criteria_input_array").val();$.ajax({url:"/admin/mailing/messages",data:{action:"fields",criteria_list:a,message_id:$("#id").val()},dataType:"JSON",type:"GET",success:function(i){a=a.split(",");for(var e=0;e<a.length;e++)if(""!=a[e])for(var t in i.criteria){var r=i.criteria[t].criteria_id;if(i.criteria[t].criteria_id==a[e])for(var n in i.criteria[t].variables){var s=i.criteria[t].variables[n];if(0==$("#var_"+r+"_"+s).length){var l=i.criteria[t].values&&i.criteria[t].values[s]?i.criteria[t].values[s]:"";$("#message_criteria_box_"+a[e]).append('<div id="var_'+r+"_"+s+'" >'+s+': <input type="text" name="var_'+r+"_"+s+'" value="'+l+'"></div>')}}}},error:function(){alert("error")}})}},lightning.admin.messages={send:function(a,i){$("#message_status").html("Starting ...\n");var e=$(".mail_buttons").fadeOut(),t=0,r=this,n={token:lightning.vars.token,action:"send-"+a,id:lightning.vars.message_id};"random"==a&&(n.count=i),$.ajax({url:"/admin/mailing/send",dataType:"text",data:n,type:"POST",stream:!0,xhrFields:{onprogress:function(a){var i=a.currentTarget.response;r.addContent("#message_status",i.substring(t)),t=i.length}},complete:function(){e.fadeIn()},error:function(){e.fadeIn()}})},addContent:function(a,i){var e=$(a);e.html(e.html()+i),e.animate({scrollTop:e.attr("scrollHeight")},500)}};
lightning.ajax={jqueryAjax:function(){},init:function(){this.jqueryAjax=jQuery.ajax,jQuery.ajax=this.call},success:function(settings,data){if("HTML"==settings.dataType)return void(settings.user_success?settings.user_success(data):lightning.dialog.showContent(data));if(lightning.dialog.clear(),data&&data.messages&&data.messages.length>0){for(var i in data.messages)lightning.dialog.add(data.messages[i],"message");lightning.dialog.show()}if(data&&data.errors&&data.errors.length>0){for(var i in data.errors)lightning.dialog.add(data.errors[i],"error");return void lightning.dialog.show()}if(data.content&&lightning.dialog.showContent(data.content),data.js_vars&&$.extend(lightning.vars,data.js_vars),data.js_startup)for(var i in data.js_startup)data.js_startup[i].requires&&data.js_startup[i].requires.length>0?lightning.require(data.js_startup[i].requires,function(){eval(data.js_startup[i].script)}):eval(data.js_startup[i].script);return data&&data.status&&"redirect"==data.status?void(document.location=data.location):void(settings.user_success&&settings.user_success(data))},error:function(a,t){if(lightning.dialog.clear(),void 0==t)lightning.dialog.add("Communication Error","error"),lightning.dialog.show();else if("string"==typeof t)lightning.dialog.add(t,"error"),lightning.dialog.show();else if(t.errors)for(var r in t.errors)lightning.dialog.add(t.errors[r],"error"),lightning.dialog.show();else lightning.dialog.add('There was an error loading the page. Please reload the page. If the problem persists, please <a href="/contact">contact support</a>.',"error"),t.hasOwnProperty("status")&&lightning.dialog.add("HTTP: "+t.status,"error"),t.hasOwnProperty("responseText")&&!t.responseText.match(/<html/i)&&lightning.dialog.add(t.responseText,"error"),lightning.dialog.show();a.user_error&&a.user_error(t)},call:function(a){a.user_error=a.error,a.user_success=a.success,a.success=function(t){lightning.ajax.success(a,t)},a.error=function(t){lightning.ajax.error(a,t)},lightning.ajax.jqueryAjax(a)}};
!function(){var a=lightning.cms={init:function(){$(".cms_edit").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_edit_/,"");a.edit(t)}),$(".cms_save").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_save_/,"");a.save(t)}),$(".cms_edit_plain").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_edit_/,"");a.editPlain(t)}),$(".cms_save_plain").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_save_/,"");a.savePlain(t)}),$(".cms_edit_image").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_edit_/,"");a.editImage(t)}),$(".cms_save_image").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_save_/,"");a.saveImage(t)}),$(".imagesCSS").keyup(function(){var a=$(this),e=a.attr("id").replace("_class",""),t=a.attr("name")+" "+a.val();$("#"+e).removeClass().addClass(t)})},edit:function(a){lightning.htmleditor.initEditor("cms_"+a),$("#cms_edit_"+a).hide(),$("#cms_save_"+a).show()},save:function(e){lightning.dialog.showLoader("Saving..."),lightning.htmleditor.deactivateEditor("cms_"+e),$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:e.replace(/^cms_/,""),token:lightning.vars.token,action:"save",content:$("#cms_"+e).html()},success:function(a){$("#cms_edit_"+e).show(),$("#cms_save_"+e).hide(),lightning.dialog.clear(),lightning.dialog.add("Saved!","message")},error:function(){a.edit(e),lightning.dialog.clear(),lightning.dialog.add("The content could not be saved, please try again!","error")}})},editImage:function(a){$("#cms_save_"+a).show(),$("#cms_"+a+"_class").show(),lightning.fileBrowser.openSelect("lightning-cms",a)},imageSelected:function(a,e){$("#cms_"+e).attr("src",a)},saveImage:function(a){lightning.dialog.showLoader("Saving..."),$("#cms_save_"+a).hide(),$("#cms_"+a+"_class").hide(),$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:a,class:$("#cms_"+a+"_class").val(),token:lightning.vars.token,action:"save-image",content:$("#cms_"+a).attr("src").replace(lightning.vars.cms.baseUrl,"")},success:function(){lightning.dialog.clear(),lightning.dialog.add("Saved!","message")},error:function(){$("#cms_save_"+a).show(),$("#cms_"+a+"_class").show(),lightning.dialog.clear(),lightning.dialog.add("The content could not be saved, please try again!","error")}})},editPlain:function(a){$("#cms_edit_"+a).hide(),$("#cms_save_"+a).show(),$("#cms_display_"+a).hide(),$("#cms_"+a).show()},savePlain:function(a){lightning.dialog.showLoader("Saving..."),$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{cms:a,token:lightning.vars.token,action:"save",content:$("#cms_"+a).val()},success:function(){$("#cms_edit_"+a).show(),$("#cms_save_"+a).hide(),$("#cms_"+a).hide(),$("#cms_display_"+a).html($("#cms_"+a).val()).show(),lightning.dialog.clear(),lightning.dialog.add("Saved!","message")},error:function(){lightning.dialog.clear(),lightning.dialog.add("The content could not be saved, please try again!","error")}})},initDate:function(){$(".cms_edit_date").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_edit_/,"");a.editDate(t)}),$(".cms_save_date").on("click",function(e){var t=$(e.target).attr("id").replace(/^cms_save_/,"");a.saveDate(t)})},editDate:function(a){$("#cms_edit_"+a).hide(),$("#cms_save_"+a).show(),$("#cms_"+a).show()},saveDate:function(a){$.ajax({url:"/admin/cms",type:"POST",dataType:"json",data:{id:a,key:$("#cms_key_"+a).val(),column:$("#cms_column_"+a).val(),table:$("#cms_table_"+a).val(),token:lightning.vars.token,action:"update-date",date_m:$("#cms_"+a+"_m").val(),date_d:$("#cms_"+a+"_d").val(),date_y:$("#cms_"+a+"_y").val()},success:function(a){var e="";for(var t in a.errors)e+=a.error[t]+" ";""==e&&(e="Could not save: Unknown error.")},error:function(){$("#cms_edit_"+a).show(),$("#cms_save_"+a).hide(),$("#cms_"+a).hide();var e=$("#cms_"+a+"_m").val()+"/"+$("#cms_"+a+"_d").val()+"/"+$("#cms_"+a+"_y").val();$("#date_"+a).text(e)}})}}}();
!function(){var n;lightning.dialog={originalScroll:0,newPosition:0,dialogBox:!1,dialogBoxLoader:void 0,dialogBoxInner:void 0,init:function(){n.dialogBox||($('<div class="reveal-modal" id="dialog_box" data-reveal aria-hidden="true" role="dialog"><a class="close-reveal-modal"><i class="fa fa-close"></i></a><div class="table_data clear border_top"><div class="inner" id="dialog_box_inner"><div class="messenger error"><ul></ul></div><div class="messenger warning"><ul></ul></div><div class="messenger message"><ul></ul></div><div class="content"><ul></ul></div></div><div class="inner" id="dialog_box_loader"></div></div></div>').prependTo("body"),n.dialogBox=$("#dialog_box"),n.dialogBoxLoader=$("#dialog_box_loader"),n.dialogBoxInner=$("#dialog_box_inner"),n.clear())},hide:function(){n.init(),n.dialogBox.foundation("reveal","close")},show:function(){n.init(),n.dialogBox.foundation("reveal","open")},showLoader:function(i){n.init(),n.clear(),n.setContent('<p align="center"><img src="/images/lightning/cog-spinner.gif" class="loader_image"></p>'),"undefined"!=typeof i&&n.addContent('<p align="center">'+i+"</p>"),n.show()},showURL:function(i){n.init(),n.showLoader(),$.ajax({dataType:"HTML",url:i,success:function(i){n.setContent(i),n.show()}})},showContent:function(i){n.init(),n.setContent(i),n.show()},clear:function(){n.init(),n.dialogBoxInner.find(".content").empty().hide(),n.dialogBoxInner.find(".error ul").empty(),n.dialogBoxInner.find(".error").hide(),n.dialogBoxInner.find(".warning ul").empty(),n.dialogBoxInner.find(".warning").hide(),n.dialogBoxInner.find(".message ul").empty(),n.dialogBoxInner.find(".message").hide()},addContent:function(i){n.init(),i=$(i).hide(),n.dialogBoxInner.find(".content").append(i),i.fadeIn("fast"),n.dialogBoxInner.fadeIn("fast"),n.dialogBoxInner.find(".content").fadeIn("fast")},add:function(i,o){n.init(),i=$("<li>"+i+"</li>");var e="message"==o?".message":"warning"==o?".warning":".error";n.dialogBoxLoader.fadeOut("fast",function(){n.dialogBoxInner.find(e).is(":visible")?(i.hide(),n.dialogBoxInner.find(e+" ul").append(i),i.fadeIn("fast")):(n.dialogBoxInner.find(e+" ul").append(i),n.dialogBoxInner.is(":visible")?n.dialogBoxInner.find(e).fadeIn("fast"):n.dialogBoxInner.find(e).show()),n.dialogBoxInner.fadeIn("fast")})},setContent:function(i,o){n.init(),n.dialogBoxInner.hide(),("undefined"==typeof o||o)&&n.clear(),n.dialogBoxInner.find(".content").html(i).show(),n.dialogBox.foundation("reveal","open"),n.dialogBoxInner.fadeIn("fast")}},n=lightning.dialog}();
lightning.fileBrowser={type:null,field:null,elf:null,funcNum:null,init:function(){var e=document.location.search.substring(1).split("&");for(var i in e){var n=e[i].split("=");"type"==n[0]&&(lightning.fileBrowser.type=n[1]),"field"==n[0]&&(lightning.fileBrowser.field=n[1]),"CKEditorFuncNum"==n[0]&&(lightning.fileBrowser.funcNum=n[1]),"url"==n[0]&&(lightning.fileBrowser.urlType=n[1]),"web_root"==n[0]&&(lightning.fileBrowser.webRoot=unescape(n[1]))}lightning.fileBrowser.elf=$("#elfinder").elfinder({url:"/elfinder",closeOnEditorCallback:!0,getFileCallback:lightning.fileBrowser.select}).elfinder("instance")},select:function(e,i){var n=e.url;switch("full"==lightning.fileBrowser.urlType&&(n=(lightning.fileBrowser.webRoot+"/"+n).replace(/([^:])\/\/+/g,"$1/")),lightning.fileBrowser.type){case"ckeditor":window.opener.CKEDITOR.tools.callFunction(lightning.fileBrowser.funcNum,n),window.close();break;case"tinymce":parent.tinymce.activeEditor.windowManager.getParams().setUrl(n);var l=parent.tinymce.activeEditor.windowManager.windows[0];l.find("#src").fire("change"),parent.tinymce.activeEditor.windowManager.close();break;case"lightning-field":window.opener.lightning.fileBrowser.fieldSelected(n,lightning.fileBrowser.field),window.close();break;case"lightning-cms":window.opener.lightning.cms.imageSelected(n,lightning.fileBrowser.field),window.close()}},openSelect:function(e,i,n){switch("undefined"==typeof n&&(n="absolute&web_root="+escape(lightning.vars.web_root)),lightning.fileBrowser.type||lightning.vars.fileBrowser.type){case"elfinder":window.open("/js/elfinder/elfinder.html?type="+e+"&field="+i+"&url="+n,"Image Browser","");break;case"ckfinder":CKFinder.popup({basePath:lightning.vars.cms.basepath,chooseFiles:!0,chooseFilesOnDblClick:!0,onInit:function(e){e.on("files:choose",function(e){var i=e.data.files.first();self.updateImage(id,i.getUrl())}),e.on("file:choose:resizedImage",function(e){self.updateImage(id,e.data.resizedUrl)})}})}},fieldSelected:function(e,i){var n=$("#file_browser_image_"+i);n.length>0&&n.prop("src",e).show(),$("#"+i).val(e)},clear:function(e){var i=$("#file_browser_image_"+e);i.length>0&&i.prop("src","").hide(),$("#"+e).val("")}};
!function(){var t=lightning.htmleditor={editors:{},init:function(){var i=lightning.vars.htmleditors;for(var e in i)if("tinymce"==i[e].editor_type)i[e].setup=t.tinymceSetup,i[e].browser&&(i[e].file_browser_callback=t.imageBrowser),i[e].startup&&t.initEditor(e);else if("ckeditor"==i[e].editor_type){(function(e){CKEDITOR.scriptLoader.queue(CKEDITOR.getUrl("config.js"),function(){"function"==typeof CKEDITOR.editorConfig&&CKEDITOR.editorConfig(CKEDITOR.config),i[e].hasOwnProperty("plugins")?i[e].plugins=i[e].plugins.replace(/\*/,CKEDITOR.config.plugins):i[e].plugins=CKEDITOR.config.plugins,i[e].hasOwnProperty("fullPage")&&i[e].fullPage&&(i[e].plugins=i[e].plugins.replace("divarea","")),i[e].startup&&t.initEditor(e)})})(e)}$(".html_editor_presave").closest("form").submit(function(){$(this).find(".html_editor_presave").each(function(){var e=$(this),n=$(this).prop("id").replace("save_","");"ckeditor"==i[n].editor_type&&e.val(t.getContent(n))})})},getContent:function(i){if("ckeditor"==lightning.vars.htmleditors[i].editor_type)return t.editors[i].getData()},initEditor:function(i){var e=$("#"+i),n=lightning.vars.htmleditors[i];n.content_rendered&&(e.html(n.content),delete n.content_rendered),"tinymce"==n.editor_type?tinymce.init(n):"ckeditor"==n.editor_type&&(e.attr("contenteditable","true"),t.editors[i]=CKEDITOR.inline(i,n))},deactivateEditor:function(i){if("tinymce"==lightning.vars.htmleditors[i].editor_type)for(var e in tinymce.editors)tinymce.editors[e].id==i&&tinymce.editors[e].remove();else"ckeditor"==lightning.vars.htmleditors[i].editor_type&&($("#"+i).attr("contenteditable","false"),t.editors[i].destroy())},tinymceSetup:function(t){t.addButton("columns",{type:"menubutton",text:"Columns",icon:!1,menu:[{text:"2 Columns",onclick:function(){t.insertContent('<div class="row"><div class="small-12 medium-6 column"><p>Column 1</p></div><div class="small-12 medium-6 column"><p>Column 2</p></div></div>')}},{text:"3 Columns",onclick:function(){t.insertContent('<div class="row"><div class="small-12 medium-4 column"><p>Column 1</p></div><div class="small-12 medium-4 column"><p>Column 2</p></div><div class="small-12 medium-4 column"><p>Column 3</p></div></div>')}},{text:"4 Columns",onclick:function(){t.insertContent('<div class="row"><div class="small-12 medium-3 column"><p>Column 1</p></div><div class="small-12 medium-3 column"><p>Column 2</p></div><div class="small-12 medium-3 column"><p>Column 3</p></div><div class="small-12 medium-3 column"><p>Column 4</p></div></div>')}}]}),t.addButton("yt",{type:"button",text:"YT",icon:!1,onclick:function(){t.insertContent('{{youtube id="" flex=true widescreen=true}}')}})},imageBrowser:function(t,i,e,n){return tinymce.activeEditor.windowManager.open({file:"/elfinder/elfinder.html?type=tinymce",title:"Image Browser",width:900,height:450,resizable:"yes"},{setUrl:function(i){n.document.getElementById(t).value=i}}),!1}}}();
lightning.jsoneditor={init:function(){for(var i in lightning.vars.jsoneditor){var n=document.getElementById(i),t={};lightning.vars.jsoneditor[i].hasOwnProperty("options")&&(t=lightning.vars.jsoneditor[i].options),t.hasOwnProperty("mode")||(t.mode="tree"),lightning.vars.jsoneditor[i].editor=new JSONEditor(n,t),lightning.vars.jsoneditor[i].editor.set(lightning.vars.jsoneditor[i].json)}$(".jsoneditor_presave").closest("form").submit(function(){$(this).find(".jsoneditor_presave").each(function(){var i=$(this),n=$(this).prop("id").replace(/_data$/,"");i.val(JSON.stringify(lightning.vars.jsoneditor[n].editor.get()))})})}};
lightning.getMethodReference=function(n){var e=n.split("."),i=window;for(var r in e)i=i[e[r]];return i};
lightning.format={sizes:["B","KB","MB","GB","TB","PB"],counts:["","k","m","b","t","q"],dataSize:function(n){return lightning.format.divide(n,1024,lightning.format.sizes,!1)},count:function(n){return lightning.format.divide(n,1e3,lightning.format.counts,!0)},divide:function(n,t,i,r){for(var e=n,a=0;e>=.9*t;)e/=t,a++;return void 0==i[a]?"Really Big":0==a&&r?e:parseFloat(e).toPrecision(3)+i[a]}},lightning.startup={init:function(){this.initForms(),this.initNav(),lightning.ajax.init(),lightning.dialog.init(),lightning.tracker.init()},initNav:function(){var n=lightning.get("menu_context");n&&$("nav ."+n).addClass("active")},initForms:function(){$(".captcha_container").closest("form").submit(function(){var n=$(this);return n&&function(){var n=0!=grecaptcha.getResponse().length;return $("#captcha_abide").val(n?1:""),n}()})}},lightning.require=function(n,t){"string"==typeof n&&(n=[n]);var i=n.length,r=0;for(var e in n){var a=document.createElement("script");a.src=n[e],a.type="text/javascript",a.async="true",a.onload=a.onreadystatechange=function(){var n=this.readyState;if((!n||"complete"==n||"loaded"==n)&&(r++,r==i))try{t()}catch(n){console.error(n)}};var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(a,g)}},lightning.get=function(n,t){if(!n)return null;"undefined"==typeof t&&(t=null),n=n.split(".");var i=lightning.vars;for(var r in n){if(!i.hasOwnProperty(n[r]))return t;i=i[n[r]]}return i},lightning.parsed_query=null,lightning.parsed_hash=null,lightning.getFromURL=function(n,t){var i="parsed_"+n;if(null==lightning[i]){var r=document.location[n].substring(1).split("&");lightning[i]={};for(var e in r)if(0!=r[e].length){var a=r[e].split("=",2);lightning[i][a[0]]=a[1]}}return lightning[i].hasOwnProperty(t)?lightning[i][t]:null},lightning.query=function(n){return lightning.getFromURL("search",n)},lightning.hash=function(n){return lightning.getFromURL("hash",n)},lightning.modules={};
lightning.multiplier={init:function(){var i=this;$(".multiplier").each(function(){$(this).on("click",".multiplier_add",null,function(t){i.addOption(t.target)}),$(this).on("click",".multiplier_remove",null,function(t){i.removeOption(t.target)}),$(this).append('<input class="multiplier_count" value="0" type="hidden" />'),$(this).find(".template").hide(),i.addOption(this)})},addOption:function(i){var t=$(i).closest(".multiplier"),l=t.find(".template").html(),e=t.find(".multiplier_count").val(),n=$('<div class="item"></div>').append(l.replace(/%/g,e+1));t.find(".multiplier_count").val(e+1),t.append(n),this.adjustControls(t)},removeOption:function(i){$(i).closest(".item").remove(),this.adjustControls($(i).closest(".multiplier"))},adjustControls:function(i){i.find(".multiplier_add").hide(),i.find(".multiplier_add").last().show(),i.find(".multiplier_remove").show()}};
!function(){var i=lightning.social={google:{signin:function(){lightning.require("https://apis.google.com/js/platform.js",function(){gapi.load("auth2",function(){var n=gapi.auth2.getAuthInstance()||gapi.auth2.init({client_id:lightning.vars.social.google.client_id});response=n.signIn().then(function(n){if(lightning.vars.social.authorize){for(var t in n)if("object"==typeof n[t]&&n[t].hasOwnProperty("access_token")){var o={access_token:n[t].access_token,created:n[t].first_issued_at,expires_in:n[t].expires_in};return void i.signinComplete("google","auth",JSON.stringify(o))}}else i.signinComplete("google","id",n.getAuthResponse().id_token)})})})},signout:function(){lightning.require("https://apis.google.com/js/platform.js",function(){gapi.load("auth2",function(){gapi.auth2.getAuthInstance()||gapi.auth2.init({client_id:lightning.vars.social.google.client_id});i.google.finalizeLogout()})})},finalizeLogout:function(){var n=gapi.auth2.getAuthInstance(),t=!1;n.signOut().then(function(){t=!0,window.location.href="/user?action=logout"}),setTimeout(function(){t||i.google.finalizeLogout()},500)}},facebook:{init:function(){FB.init({appId:lightning.vars.social.facebook.appid,cookie:!0,xfbml:!1,version:"v2.2"})},signin:function(){if(!lightning.vars.social.facebook.appid)return void console.log("Missing facebook app ID");i.facebook.init();var n={},t=lightning.get("social.facebook.scope");t&&(n.scope=t),FB.login(i.facebook.signinComplete,n)},signinComplete:function(n){"connected"===n.status?lightning.vars.social.authorize?i.signinComplete("facebook","auth",n.authResponse.accessToken):i.signinComplete("facebook","id",n.authResponse.signedRequest):console.log("could not sign in to facebook")},signout:function(){}},twitter:{signin:function(){window.location.href=lightning.vars.social.twitter.signin_url}},initShare:function(){$(".social-share").on("click","div",i.shareClick)},shareClick:function(){var n=$(this),t=n.closest(".social-share").data("url");n.is(".facebook")?i.sharePop("http://www.facebook.com/sharer.php?u="+t):n.is(".twitter")?i.sharePop("https://twitter.com/intent/tweet?url="+t):n.is(".google")?i.sharePop("https://plus.google.com/share?url="+t):n.is(".linkedin")&&i.sharePop("http://www.linkedin.com/shareArticle?mini=true&url="+t)},sharePop:function(i){var n=350,t=520,o=screen.height/2-n/2,e=screen.width/2-t/2;window.open(i,"sharer","top="+o+",left="+e+",toolbar=0,status=0,width="+t+",height="+n)},initLogout:function(n){$(".logout_button").on("click",function(t){t.preventDefault(),i[n].signout()})},initLogin:function(){$(".social-signin").on("click",function(){$(this).is(".google")&&i.google.signin(),$(this).is(".facebook")&&i.facebook.signin(),$(this).is(".twitter")&&i.twitter.signin()})},signinComplete:function(i,n,t){var o=lightning.get("social.signin_url");null==o&&(o="/user");var e=$('<form method="post" style="display:none">').attr("action",o);e.append('<input type="hidden" name="token" value="'+lightning.vars.token+'">');var s=lightning.get("social.login_redirect");s&&e.append('<input type="hidden" name="redirect" value="'+s+'">'),e.append('<input type="hidden" name="action" value="'+i+'-login">'),e.append($('<input type="hidden" name="'+n+'-token">').val(t)),e.submit()}}}();

lightning.stats={charts:{},loadData:function(){var a={sets:[]};$("#stats_controls select").not("#tracker_\\%").each(function(){var t=$(this).attr("id").replace("tracker_","");a.sets.push({tracker:$("#tracker_"+t).val(),sub_id:$("#sub_id_"+t).val()})}),this.getTrackerStats(a,this.updateStats)},drawData:function(a,t){var r=document.getElementById(a).getContext("2d"),e=lightning.vars.chart[a].renderer;lightning.stats.charts[a]&&lightning.stats.charts[a].destroy(),lightning.stats.charts[a]=new Chart(r)[e](t,{responsive:!0,datasetFill:!1})},updateTotals:function(a,t){var r=$("#chart_totals_"+a);if(1==r.length)if(r.empty(),t.datasets)for(var e in t.datasets){var s=0;if(t.datasets[e].total_average)s=t.datasets[e].total_average;else for(var n in t.datasets[e].data)s+=parseInt(t.datasets[e].data[n]);var i="";if(lightning.vars.chart[a].params.diff){difference=s-t.datasets[e].previous;var c=difference<0?"red":"green",l=difference<0?"":"+",d=0!=t.datasets[e].previous?(100*difference/t.datasets[e].previous).toFixed(1):0;i='<span class="strong '+c+'">'+l+difference+" ("+d+"%)</span>"}lightning.vars.chart[a].params.number_format&&"money"==lightning.vars.chart[a].params.number_format&&(s="$"+s.toFixed(2)),r.append($("<li>"+(t.datasets[e].label?t.datasets[e].label:e)+": "+s+" "+i+"</li>"))}else{var o=0;for(var e in t)o+=t[e].value;r.append($("<li>Total: "+o+"</li>"))}},getTrackerStats:function(a,t,r){t.action="trackerStats",$.ajax({type:"GET",url:"/admin/tracker",dataType:"JSON",data:t,success:r})},getParameters:function(a){if(lightning.vars.chart[a].params){var t={};for(var r in lightning.vars.chart[a].params){var e=lightning.vars.chart[a].params[r];e.source?t[r]=$("#chart_controls_"+a+" #"+e.source).val():e.value&&(t[r]=e.value)}return t}return{}},updateStats:function(a){var t=this,r=this.getParameters(a);r.action="get-data",r.id=a,$.ajax({type:"GET",url:lightning.vars.chart[a].url,dataType:"JSON",data:r,success:function(r){t.drawData(a,r.data),t.updateTotals(a,r.data)}})},init:function(){var a=this;$(".chart_controls input, .chart_controls select").change(function(t){var r=$(t.target).closest(".chart_controls").attr("id").replace("chart_controls_","");a.updateStats(r)});for(var t in lightning.vars.chart)lightning.vars.chart[t].data?(a.drawData(t,lightning.vars.chart[t].data),a.updateTotals(t,lightning.vars.chart[t].data)):lightning.vars.chart[t].ajax&&a.updateStats(t)}};
!function(){var e=lightning.table={init:function(){$(".add_image").on("click",e.clickAddImage),$(".linked_images").on("click",".remove",e.removeLinkedImage),$("table.table_form_table").on("click",".remove-link",function(t){var a=$(t.target);e.removeLink(a.data("link"),a.data("link-item"))}).on("click",".add-link",e.clickAddLink),e.filterContainer=$(".filters"),e.filterContainer.on("change","select",e.search),e.filterContainer.on("click",".remove",e.removeFilter),e.filterSelect=$("#filters"),e.filterSelect.on("change",e.addNewFilter),e.filters=lightning.get("table.filters",[]),e.textSearch=$("#table_search"),e.textSearch.on("keyup",e.search),$(".autocomplete_field").on("keyup",e.autocomplete),$(".autocomplete_link").on("keyup",e.autocomplete)},addNewFilter:function(){var t=e.filterSelect.val();if(""!=t){e.filterSelect.val("");var a=$('<fieldset class="filter row"><div class="small-1 column"><i class="fa fa-close remove"></i></div></fieldset>');a.data("name",t);for(var n in e.filters[t].options){if("select"==e.filters[t].options[n].type){var l=$("<select>");l.prop("name",n);for(var i in e.filters[t].options[n].options){var o=$("<option>");o.prop("value",i),o.html(e.filters[t].options[n].options[i]),l.append(o)}}a.append($('<div class="small-11 medium-5 column"></div>').append(l))}e.filterContainer.append(a),this.search()}},removeFilter:function(e){$(e.target).closest(".filter").remove(),this.search()},click:function(t){var a=t.currentTarget.id;if("INPUT"!=t.target.tagName&&void 0!=lightning.vars.table_data.rowClick)switch(lightning.vars.table_data.rowClick.type){case"url":document.location=lightning.vars.table_data.rowClick.url+a;break;case"action":document.location=e.createUrl(lightning.vars.table_data.rowClick.action,a)}},createUrl:function(e,t){var a=[];if(a.push("action="+encodeURIComponent(e)),a.push("id="+encodeURIComponent(t)),lightning.vars.table_data.table&&a.push("table="+encodeURIComponent(table_data.table)),lightning.vars.table_data.parent_link&&a.push(table_data.parent_link+"="+encodeURIComponent(lightning.vars.table_data.parent_id)),lightning.vars.table_data.vars)for(var n in lightning.vars.table_data.vars)null!=lightning.vars.table_data.vars[n]&&a.push(n+"="+encodeURIComponent(lightning.vars.table_data.vars[n]));return url="?"+a.join("&")},selectAll:function(e){$(".taf_"+e).prop("checked",$("#taf_all_"+e).is(":checked"))},searchTimeout:null,searchIndex:0,searchIndexDisplayed:0,search:function(){var t=e.textSearch.val(),a=[];e.filterContainer.find(".filter").each(function(){var e=$(this);a.push({filter:e.data("name"),operator:e.find('select[name="operator"] option:selected').val(),value:e.find('select[name="value"] option:selected').val()})}),e.searchIndex++,clearTimeout(e.searchTimeout),e.searchTimeout=setTimeout(function(){lightning.vars.table_data.vars.ste=t,$.ajax({url:lightning.get("table_data.action_file"),type:"GET",dataType:"json",data:{ste:t,i:e.searchIndex,action:"search",filter:a},success:function(t){t.d>e.searchIndexDisplayed&&(e.searchIndexDisplayed=t.d,$(".table_list").html(t.html))}})},500)},clickAddLink:function(t){var a=$(t.target),n=a.closest("td").find("select option:selected");e.addLink(a.data("link"),n.val(),n.html())},addLink:function(e,t,a){if(0!=e||""!=t){var n=new RegExp("(^|,)"+t+","),l=$("#"+e+"_input_array");if(null==l.val().match(n)){l.val(l.val()+t+","),$("#"+e+"_list_container").append($('<div class="'+e+'_box table_link_box_selected" id="'+e+"_box_"+t+'">'+a+' <i class="remove-link fa fa-close" data-link="'+e+'" data-link-item="'+t+'"></i></div>'));var i=lightning.get("table.linkProcess");for(var o in i)lightning.getMethodReference(i[o])()}}},removeLink:function(e,t){$("#"+e+"_box_"+t).remove();var a=$("#"+e+"_input_array"),n=a.val(),l=new RegExp("[\\^,]"+t+",","i");n=n.replace(l,","),l=new RegExp("^"+t+",","i"),n=n.replace(l,""),a.val(n)},clickAddImage:function(t){var a=t.target.id.replace("add_image_","");CKFinder.popup({basePath:lightning.vars.table.links[a].web_location,chooseFiles:!0,chooseFilesOnDblClick:!0,onInit:function(t){t.on("files:choose",function(t){var n=t.data.files.first();e.addImageCallback(a,n.getUrl())}),t.on("file:choose:resizedImage",function(t){e.addImageCallback(a,t.data.resizedUrl)})}})},addImageCallback:function(e,t){$("#linked_images_"+e).append('<span class="selected_image_container"><input type="hidden" name="linked_images_'+e+'[]" value="'+t+'"><span class="remove">X</span><img src="'+t+'" /></span>')},removeLinkedImage:function(e){$(e.target).closest(".selected_image_container").remove()},autocompleteCache:{field:{},link:{}},autocomplete:function(){var t=$(this),a=t.data("name"),n=t.val(),l=t.data("type");n.length<2||e.autocompleteCache[l][a]&&e.autocompleteCache[l][a].lastFetch==n||(e.autocompleteCache[l][a]={lastFetch:n},$.ajax({url:lightning.get("table_data.action_file"),type:"get",dataType:"json",data:{action:"autocomplete",field:t.data("name"),type:l,search:n},success:function(t){n==e.autocompleteCache[l][a].lastFetch&&e.autocompleteDropdown(a,l,t.results)}}))},autocompleteDropdown:function(t,a,n){$(".autocomplete_options").each(function(){$(this).attr("id")!="table_container_"+t?$(this).remove():$("#list_"+t).empty()}),0==$(".autocomplete_options").length&&$("#"+t+"_autocomplete").after('<div id="table_container_'+t+'" class="autocomplete_options" data-field="'+t+'" data-type="'+a+'"><div id="list_'+t+'"></div></div>');var l=$("#list_"+t);"link"==a&&lightning.get("table_data.links."+t+".create")&&(l.append('<span class="create">Create a new entry</span>'),l.on("click",".create",e.setAutocompleteCreateNew));for(var i in n)l.append('<span class="select" data-value="'+i+'" >'+n[i]+"</span>");l.on("click",".select",e.setAutocompleteSelection)},setAutocompleteSelection:function(t){var a=$(this),n=a.closest(".autocomplete_options"),l=n.data("field"),i=a.data("value");switch(n.remove(),n.data("type")){case"link":e.addLink(l,i,a.html());break;case"field":default:$("#"+l).val(i)}},setAutocompleteCreateNew:function(t){var a=$(this),n=a.closest(".autocomplete_options"),l=n.data("field"),i=n.closest("td").find('input[data-type="link"]').val();$.ajax({url:lightning.get("table_data.action_file"),type:"POST",dataType:"JSON",data:{action:"create-link",link:l,value:i,token:lightning.vars.token},success:function(t){n.remove(),e.addLink(l,t.id,t.value)}})},deleteSubtable:function(e){var t=$(e).closest("div").attr("id").replace("subtable_",""),a=t.split("_");a=a[a.length-1],entry_id_table=t.replace("_"+a,""),parseInt(a)>0?$("#delete_subtable_"+entry_id_table).val($("#delete_subtable_"+entry_id_table).val()+a+","):(reg=new RegExp(Math.abs(a)+","),$("#new_subtable_"+entry_id_table).val($("#new_subtable_"+entry_id_table).val().replace(reg,""))),$("#subtable_"+entry_id_table+"_"+a).fadeOut(function(){$(this).remove()})},newSubtable:function(e){"undefined"==typeof new_subtables&&(new_subtables=Array()),"undefined"==typeof new_subtables[e]?new_subtables[e]=1:new_subtables[e]++,$("#subtable_"+e+"__N_").before($("<div class='subtable' id='subtable_"+e+"_-"+new_subtables[e]+"'></div>").html($("#subtable_"+e+"__N_").html().replace(/_N_/g,"-"+new_subtables[e]))),$("#new_subtable_"+e).val($("#new_subtable_"+e).val()+new_subtables[e]+",")},newPop:function(e,t,a){e.indexOf("?")>-1?window.open(e+"&action=pop&pf="+t+"&pfdf="+a+"&pop=1","New","width=400,height=500"):window.open(e+"?action=pop&pf="+t+"&pfdf="+a+"&pop=1","New","width=400,height=500")},returnPop:function(e){window.opener.$("#"+e.pf+"_list").append("<option value='"+e.id+"'>"+e.pfdf+"</option>").val(e.id),window.close()},export:function(e){var t=$('[name="table_search"]').val();console.log(e);var a=$(e).attr("href");""!=t&&(a+="&ste="+t),window.location=a},resetField:function(e){"undefined"!=typeof CKEDITOR.instances[e]?CKEDITOR.instances[e].setData(lightning.vars.table_data.defaults[e]):"undefined"!=typeof("#"+e).val?$("#"+e).val(lightning.vars.table_data.defaults[e]):$("#"+e).html(lightning.vars.table_data.defaults[e])}}}();
!function(){var e=lightning.tracker={ready:!1,queue:[],events:{pageView:{ga:"pageview",fb:"PageView"},viewContent:{fb:"ViewContent"},search:{fb:"Search"},addToCart:{fb:"AddToCart",ga:"event",category:"Store"},addToWishlist:{fb:"AddToWishlist",ga:"event",category:"Store"},initiateCheckout:{fb:"InitiateCheckout",ga:"event",category:"Store"},addPaymentInfo:{fb:"AddPaymentInfo",ga:"event",category:"Store"},purchase:{fb:"Purchase",ga:"event",category:"Store"},optin:{fb:"Lead",ga:"event",category:"User",action:"optin"},register:{fb:"CompleteRegistration",ga:"event",category:"User",action:"register"},splitTest:{ga:"event",label:"Split Test"}},init:function(){var t=[];lightning.vars.google_analytics_id&&t.push("//www.google-analytics.com/analytics.js"),lightning.vars.facebook_pixel_id&&(n=window.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)},window._fbq||(window._fbq=n),n.push=n,n.loaded=!0,n.version="2.0",n.queue=[],t.push("//connect.facebook.net/en_US/fbevents.js")),t.length>0&&lightning.require(t,function(){lightning.vars.google_analytics_id&&ga("create",lightning.vars.google_analytics_id,"auto"),lightning.vars.facebook_pixel_id&&fbq("init",lightning.vars.facebook_pixel_id),e.track(e.events.pageView),e.ready=!0;for(var t in e.queue)e.trackOnStartup(e.queue[t])})},trackOnStartup:function(t){e.ready?(type=t.type,event=e.events.hasOwnProperty(type)?e.events[type]:{action:type,ga:"event"},e.track(event,{category:t.category,label:t.label})):e.queue.push(t)},track:function(e,t){var a={};$.extend(a,e,t),lightning.vars.google_analytics_id&&a.hasOwnProperty("ga")&&ga("send",a.ga,a.category?a.category:void 0,a.fb?a.fb:a.action?a.action:void 0,a.label?a.label:void 0,a.value?a.value:void 0),lightning.vars.facebook_pixel_id&&a.hasOwnProperty("fb")&&fbq("track",a.fb)}}}();
function tree_clear(e){var t=!1;$(".tree_column").each(function(){t&&$(this).remove(),$(this).attr("id").replace("tree_column_","")==e&&(t=!0)})}function tree_sub_click(){var e=$(this).closest(".tree_column").attr("id").replace("tree_column_","");if(tree_clear(e),$("#tree_column_"+e+" .selected").removeClass("selected"),$(this).addClass("selected"),$(this).hasClass("tree_column_directory")){var t=$(this).attr("id").replace("tree_node_","");$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"load_node",node_id:t},success:function(e){if("error"==e.status)alert(e.error);else{$("#tree_"+tree_data.tree_name).append("<div class='tree_column' id='tree_column_"+e.node_id+"'></div>"),$("#tree_column_"+e.node_id).append(tree_node_header(e));for(i in e.nodes)$("#tree_column_"+e.node_id).append(tree_node_string(e.nodes[i].node_name,e.nodes[i].node_id));for(i in e.items)$("#tree_column_"+e.node_id).append("<div class='tree_column_row tree_column_item' id='tree_obj_"+e.items[i].item_id+"'>"+e.items[i].item_title+"</div>");$("#tree_column_"+e.node_id+" .tree_column_row").on("click",tree_sub_click);var t=$("#tree_"+tree_data.tree_name).find(".tree_column").length*($("#tree_"+tree_data.tree_name).find(".tree_column").first().width()+1);$("#tree_"+tree_data.tree_name).css("width",t),$("#tree_"+tree_data.tree_name).parent().scrollLeft($("#tree_"+tree_data.tree_name).width()-$("#tree_"+tree_data.tree_name).parent().width())}}})}else{var t=$(this).attr("id").replace("tree_obj_","");$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"obj_detail",id:t},success:function(e){$("#tree_"+tree_data.tree_name).append("<div class='tree_column tree_column_obj' id='tree_column_obj_"+e.id+"'>"+e.html+"</div>");var t=$("#tree_"+tree_data.tree_name).find(".tree_column").length*($("#tree_"+tree_data.tree_name).find(".tree_column").first().width()+1);$("#tree_"+tree_data.tree_name).css("width",t),$("#tree_"+tree_data.tree_name).parent().scrollLeft($("#tree_"+tree_data.tree_name).width()-$("#tree_"+tree_data.tree_name).parent().width())}})}}function tree_add(e){var t=prompt("Enter a name for the new directory:"),r=$(e).closest(".tree_column");null!=t&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"add_node",node_id:r.attr("id").replace("tree_column_",""),name:t},success:function(t){if("ok"==t.status){var n=!1;r.find(".tree_column_row").each(function(){if($(this).html().replace(/\<span\>.*\<\/span\>/,"").toLowerCase()>t.name.toLowerCase())return $(this).before(tree_node_string(t.name,t.node_id)),$("#tree_node_"+t.node_id).on("click",tree_sub_click),n=!0,!1}),n||($(e).closest(".tree_column").append(tree_node_string(t.name,t.node_id)),$("#tree_node_"+t.node_id).on("click",tree_sub_click))}}})}function tree_delete(e){var t=$(e).closest(".tree_column").attr("id").replace("tree_column_",""),r=$("#tree_node_"+t).html().replace(/\<span\>.*\<\/span\>/,""),n=confirm("Are you sure you want to delete the node '"+r+"' ?");1==n&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"remove_node",node_id:t},success:function(e){"ok"==e.status?(parent_node=$("#tree_node_"+t).closest(".tree_column").attr("id").replace("tree_column_",""),$("#tree_node_"+t).remove(),tree_clear(parent_node)):alert("Error!")}})}function tree_rename(e){var t=$(e).closest(".tree_column").attr("id").replace("tree_column_",""),r=$("#tree_node_"+t).html().replace(/\<span\>.*\<\/span\>/,""),n=prompt("Enter a name for the new directory:",r);null!=n&&$.ajax({url:tree_data.action_file,type:"POST",dataType:"json",data:{action:"rename_node",node_id:t,name:n},success:function(e){"ok"==e.status?$("#tree_node_"+t).html($("#tree_node_"+t).html().replace(r,n)):alert("Error!")}})}function tree_upload(e){var t=$(e).closest(".tree_column").attr("id").replace("tree_column_","");document.location=tree_data.action_file+"?node_id="+t+"&action=new"}function tree_node_string(e,t){return"<div class='tree_column_row tree_column_directory' id='tree_node_"+t+"'>"+e+"<span>&gt</span></div>"}function tree_node_header(e){return buttons="",buttons+=e.actions_before,1==e.upload&&(buttons+="<img src='/images/app/send_doc.png' title='Upload' onclick='tree_upload(this);' /> "),1==e.add&&(buttons+="<img src='/images/app/new2.png' title='New Folder' onclick='tree_add(this);' /> "),1==e.edit&&(buttons+="<img src='/images/app/pencil.png' title='Rename' onclick='tree_rename(this);' /> <img src='/images/app/remove2.png' title='Remove' onclick='tree_delete(this);' />"),"<div class='tree_column_header'><span>"+e.node_name+"</span>"+buttons+"</div>"}
lightning.video={players:{},init:function(){var i=this;for(var e in lightning.vars.videos){var t=lightning.vars.videos[e];if(t.call||(t.call=[]),t.playlist){var a=$("<ul>");for(var l in t.playlist)a.append('<li id="video_link_'+e+"_"+l+'" class="playlist_link">'+t.playlist[l].title+"</li>");$("#video_playlist_"+e).html(a),$(".video_playlist").on("click",".playlist_link",this.clickPlaylist)}t.call.beforeLoad?lightning.getMethodReference(t.call.beforeLoad)(e,function(){i.load(e)}):this.load(e)}},initYouTube:function(){$(".youtube:not(.initted)").each(function(){var i="//i.ytimg.com/vi/"+this.id+"/maxresdefault.jpg",e="//i.ytimg.com/vi/"+this.id+"/hqdefault.jpg",t=new Image,a=$(this);t.onerror=function(){$(this).css("background-image","url("+e+")")},t.onload=function(){this.width<=120?a.css("background-image","url("+e+")"):a.css("background-image","url("+i+")")},t.src=i,a.append($("<div/>",{class:"play"})),a.data("autoplay")?lightning.video.playYouTube(a):$(document).delegate("#"+this.id,"click",function(){lightning.video.playYouTube($(this))}),a.addClass("initted")})},playYouTube:function(i){var e=$(i),t="https://www.youtube.com/embed/"+e.prop("id")+"?autoplay=1&autohide=1&modestbranding=0&showinfo=0&rel=0";e.data("params")&&(t+="&"+e.data("params"));var a=$("<iframe/>",{frameborder:"0",src:t,width:"100%",height:"100%"});e.replaceWith(a)},clickPlaylist:function(i){var e=i.currentTarget.id.replace("video_link_",""),t=e.match(/[0-9]+$/),a=e.replace("_"+t,"");lightning.video.players[a].dispose(),lightning.video.load(a,t,!0)},load:function(i,e,t){var a=lightning.vars.videos[i],l=$("#video_"+i);e||(e=0);var n,o=a.playlist?a.playlist[e]:a,s=o.controls||!o.hasOwnProperty("controls")&&(!a.hasOwnProperty("controls")||a.controls),r=a.hasOwnProperty("width")?a.width:640,d=a.hasOwnProperty("height")?a.width:320;if(o.mp4||o.ogg||o.webm){n="<video id=video_player_"+i+' class="video-js vjs-default-skin" width="'+r+'" height="'+d+'" poster="'+(o.still?o.still:a.still?a.still:"")+'" '+(s?"controls":"")+" preload>";for(var c in{mp4:1,ogg:1,webm:1})o[c]&&(n+='<source src="'+o[c]+'" type="video/'+c+';">');n+="</video>"}else{n="<audio id=video_player_"+i+' class="video-js vjs-default-skin" width="'+r+'" height="'+d+'" '+(s?"controls":"")+" preload>";for(var c in{mp3:1})o[c]&&(n+='<source src="'+o[c]+'" type="audio/'+c+';">');n+="</audio>"}l.append(n),this.players[i]=videojs(document.getElementById("video_player_"+i),{width:"100%",controls:s}),a.classes&&$("#video_player_"+i).addClass(a.classes),(a.autoPlay||t)&&(this.players[i].play(),a.startTime&&a.startTime>0&&this.players[i].currentTime(a.startTime),a.call.afterLoad&&this.players[i].one("play",a.call.afterLoad)),a.call.onEnd&&this.players[i].on("ended",lightning.getMethodReference(a.call.onEnd));var p=this;a.call.onTime&&this.players[i].on("timeupdate",function(){p.timeCallback(p.players[i],lightning.vars.videos[i].call.onTime)}),a.hasOwnProperty("analytics_events")||(a.analytics_events=!1);var h=0;a.analytics_events&&(this.players[i].on("ended",function(){lightning.video.track(i,"ended")}),this.players[i].on("pause",function(){lightning.video.track(i,"paused",p.players[i].currentTime(),!0)}),this.players[i].on("play",function(){lightning.video.track(i,"played",p.players[i].currentTime(),!0)}),this.players[i].on("timeupdate",function(){var e=parseInt(p.players[i].currentTime());h!=e&&e%10==0&&(h=e,lightning.video.track(i,"watching",e))}))},track:function(i,e,t,a){void 0==a&&(a=!1),ga("send","event","video."+i,e,"time",t,{nonInteraction:a?1:0})},timeCallback:function(i,e){var t=i.currentTime();for(var a in e)t>=a&&(lightning.getMethodReference(e[a])(),delete e[a])}};